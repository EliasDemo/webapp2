import{a as c}from"./chunk-LWNR2F3M.js";import{C as h}from"./chunk-FE5WSVYG.js";import{K as m,O as a,T as i,Tb as r,fa as p,j as l,o as u,w as d}from"./chunk-63T4HJ2B.js";var s=class s{constructor(){this.http=i(h);this.base=i(c)}me(){return this.http.get(`${this.base}/users/me`).pipe(u(e=>e.user))}byUsername(e){return this.http.get(`${this.base}/users/by-username/${encodeURIComponent(e)}`).pipe(u(t=>t.user))}};s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=a({token:s,factory:s.\u0275fac,providedIn:"root"});var n=s;var o=class o{constructor(){this.api=i(n);this._user=p(null);this.user=this._user.asReadonly();this.name=r(()=>this._user()?.full_name??"");this.email=r(()=>this._user()?.email??"");this.status=r(()=>this._user()?.status??"");this.photo=r(()=>this._user()?.profile_photo_url??this._user()?.profile_photo??null);this.universidad=r(()=>this._user()?.expediente_activo?.universidad?.nombre??"\u2014");this.sede=r(()=>this._user()?.expediente_activo?.sede?.nombre??"\u2014");this.facultad=r(()=>this._user()?.expediente_activo?.facultad?.nombre??this._user()?.expediente_activo?.escuela_profesional?.facultad?.nombre??"\u2014");this.escuela=r(()=>this._user()?.expediente_activo?.escuela_profesional?.nombre??"\u2014");this.permissions=r(()=>this._user()?.permissions??[]);this.permSet=r(()=>new Set(this.permissions()));this.has=e=>this.permSet().has(e);this.hasAny=e=>e.some(t=>this.permSet().has(t));this.hasAll=e=>e.every(t=>this.permSet().has(t));this.roles=r(()=>this._user()?.roles??[]);this.roleSet=r(()=>new Set(this.roles()));this.hasRole=e=>this.roleSet().has(e);this.hasAnyRole=e=>e.some(t=>this.roleSet().has(t));this.hasAllRole=e=>e.every(t=>this.roleSet().has(t))}loadMe(){this.api.me().subscribe({next:e=>this._user.set(e),error:()=>this._user.set(null)})}loadIfNeeded$(){return this._user()?l(this._user()):this.api.me().pipe(m(e=>this._user.set(e)),d(()=>(this._user.set(null),l(null))))}clear(){this._user.set(null)}};o.\u0275fac=function(t){return new(t||o)},o.\u0275prov=a({token:o,factory:o.\u0275fac,providedIn:"root"});var g=o;export{g as a};
