import{a as N,b as D,c as z}from"./chunk-IXC5PNGZ.js";import{B as A,b as T,c as M,d as V,e as U,f as O,h as y,j,n as R,q}from"./chunk-J2XPQYKK.js";import"./chunk-LWNR2F3M.js";import{f as L}from"./chunk-5VQTM22E.js";import{k as I}from"./chunk-FE5WSVYG.js";import{$a as t,Ka as E,Pa as p,T as x,Tb as v,Y as u,Z as f,_a as l,ab as n,bb as g,eb as S,fa as m,fb as F,gb as C,kb as b,mb as d,tb as w,ua as k,vb as o,wb as P,xb as _,ya as r}from"./chunk-63T4HJ2B.js";import"./chunk-IMPBB4AK.js";function B(i,a){i&1&&(t(0,"span",25),o(1," Universidad Peruana Uni\xF3n "),n())}function W(i,a){if(i&1&&(S(0),o(1),F()),i&2){let e=d(2);r(),_(" \u2022 ",e.escuela()," ")}}function Y(i,a){if(i&1&&(t(0,"span",25),o(1),p(2,W,2,1,"ng-container",26),n()),i&2){let e=d();r(),_(" ",e.sede()||"Universidad Peruana Uni\xF3n"," "),r(),l("ngIf",e.escuela())}}function H(i,a){i&1&&(t(0,"small",33),o(1," Este campo es obligatorio. "),n())}function J(i,a){if(i&1){let e=C();t(0,"form",27),b("ngSubmit",function(){u(e);let c=d();return f(c.submitLookup())}),t(1,"div",28)(2,"label",29),o(3,"Usuario institucional"),n(),g(4,"input",30),p(5,H,2,0,"small",31),n(),t(6,"button",32),o(7," Continuar "),n()()}if(i&2){let e=d();l("formGroup",e.lookupForm),r(5),l("ngIf",e.username.invalid&&e.username.touched),r(),l("disabled",e.lookupForm.invalid)}}function K(i,a){if(i&1&&(t(0,"span"),o(1),n()),i&2){let e=d(2);r(),_("",e.escuela()," \u2022 ")}}function Q(i,a){if(i&1&&(t(0,"div",51)(1,"div",52)(2,"span"),o(3,"\u{1F512}"),n()(),t(4,"div",53)(5,"strong"),o(6,"Cuenta temporalmente bloqueada"),n(),t(7,"p"),o(8),n()()()),i&2){let e=d(2);r(8),P(e.loginError())}}function X(i,a){i&1&&(t(0,"small",33),o(1," La contrase\xF1a es requerida. "),n())}function Z(i,a){if(i&1&&(t(0,"small",33),o(1),n()),i&2){let e=d(2);r(),_(" ",e.loginError()," ")}}function $(i,a){if(i&1){let e=C();t(0,"form",27),b("ngSubmit",function(){u(e);let c=d();return f(c.submitLogin())}),t(1,"div",34)(2,"div",35),g(3,"img",36),n(),t(4,"div",37)(5,"div",38),o(6),n(),t(7,"div",39),p(8,K,2,1,"span",26),t(9,"span"),o(10),n()()(),t(11,"button",40),b("click",function(){u(e);let c=d();return f(c.back())}),o(12," Cambiar usuario "),n()(),p(13,Q,9,1,"div",41),t(14,"div",28)(15,"label",42),o(16,"Contrase\xF1a"),n(),t(17,"div",43),g(18,"input",44),t(19,"button",45),b("click",function(){u(e);let c=d();return f(c.togglePasswordVisibility())}),t(20,"span",46),o(21),n()()(),p(22,X,2,0,"small",31)(23,Z,2,1,"small",31),t(24,"div",47)(25,"a",48),b("click",function(c){return u(e),d().requestPasswordReset(),f(c.preventDefault())}),o(26," \xBFOlvidaste tu contrase\xF1a? "),n()()(),t(27,"div",49)(28,"button",50),b("click",function(){u(e);let c=d();return f(c.back())}),o(29," Cambiar usuario "),n(),t(30,"button",32),o(31),n()()()}if(i&2){let e=d();l("formGroup",e.loginForm),r(3),l("src",e.profilePhoto()||"assets/photo.svg",k),r(3),P(e.fullName()),r(2),l("ngIf",e.escuela()),r(2),P(e.rol()||"Usuario"),r(3),l("ngIf",e.isLocked()),r(5),w("error",e.loginError()&&!e.isLocked()),l("type",e.showPassword()?"text":"password")("disabled",e.isLocked()),r(),l("disabled",e.isLocked()),r(2),_(" ",e.showPassword()?"\u{1F648}":"\u{1F441}"," "),r(),l("ngIf",e.password.invalid&&e.password.touched),r(),l("ngIf",e.loginError()&&!e.isLocked()),r(7),l("disabled",e.loginForm.invalid||e.isLocked()),r(),_(" ",e.isLocked()?"Cuenta bloqueada":"Ingresar"," ")}}var h=class h{constructor(){this.api=x(D);this.alerts=x(N);this.router=x(L);this.footerToast=x(z);this.lang=document.documentElement.lang||"es";this._step=m(1);this.step=this._step.asReadonly();this.showPassword=m(!1);this.loginError=m("");this.lookupForm=new O({username:new y("",{nonNullable:!0,validators:[M.required]})});this.loginForm=new O({password:new y("",{nonNullable:!0,validators:[M.required]})});this._fullName=m("");this._profilePhoto=m(null);this._escuela=m(null);this._sede=m(null);this._rol=m(null);this.fullName=this._fullName.asReadonly();this.profilePhoto=this._profilePhoto.asReadonly();this.escuela=this._escuela.asReadonly();this.sede=this._sede.asReadonly();this.rol=this._rol.asReadonly();this.title=v(()=>this.step()===1?"Identif\xEDcate":"Escribe tu contrase\xF1a");this.isLocked=v(()=>{let a=this.loginError();return!!a&&a.toLowerCase().includes("demasiados intentos fallidos")})}get username(){return this.lookupForm.controls.username}get password(){return this.loginForm.controls.password}togglePasswordVisibility(){this.showPassword.update(a=>!a)}submitLookup(){if(this.lookupForm.invalid){this.lookupForm.markAllAsTouched();return}let a=this.username.value.trim();this.api.lookup({username:a}).subscribe({next:e=>{this._fullName.set(e.user.full_name),this._profilePhoto.set(e.user.profile_photo??null);let s=e.user.rol_principal??e.user.roles?.[0]??null;this._rol.set(s),this._escuela.set(e.academico?.escuela_profesional??null),this._sede.set(e.academico?.sede??null),this._step.set(2),this.loginError.set("")},error:e=>{e?.status===404?this.alerts.warn("Usuario no encontrado."):this.alerts.error("No se pudo verificar el usuario.")}})}back(){this.loginForm.reset(),this.showPassword.set(!1),this.loginError.set(""),this._step.set(1)}submitLogin(){if(this.loginForm.invalid){this.loginForm.markAllAsTouched();return}let a={username:this.username.value.trim(),password:this.password.value};this.api.login(a).subscribe({next:()=>{this.loginError.set(""),this.password.reset(),this.showPassword.set(!1),this.alerts.success("Bienvenido \u{1F44B}"),this.router.navigateByUrl("/dashboard").then(()=>{this.footerToast.showWelcome(5e3)})},error:e=>{if(e?.status===422){let s=e.error?.errors?.credentials?.[0]??"Credenciales inv\xE1lidas.";this.loginError.set(s),this.alerts.warn(s),this.password.reset(),this.showPassword.set(!1)}else this.loginError.set("Error al iniciar sesi\xF3n. Intenta nuevamente."),this.alerts.error("No se pudo iniciar sesi\xF3n.")}})}requestPasswordReset(){if(!this.username.value.trim()){this.alerts.warn("Ingresa tu usuario para restablecer la contrase\xF1a.");return}this.alerts.info("Funci\xF3n de restablecimiento en desarrollo\u2026")}ngOnDestroy(){}};h.\u0275fac=function(e){return new(e||h)},h.\u0275cmp=E({type:h,selectors:[["app-login-page"]],decls:43,vars:9,consts:[[1,"login-container"],[1,"login-shell"],[1,"brand-panel"],["src","assets/peru.jpg","alt","Universidad UPeU",1,"brand-background"],[1,"brand-overlay"],[1,"brand-content"],[1,"brand-logo-row"],["src","https://upeu.edu.pe/wp-content/uploads/2022/04/logo-upeu-dark-svg.svg","alt","UPeU","onerror","this.style.display='none'",1,"brand-logo"],["class","brand-campus",4,"ngIf"],[1,"brand-title"],[1,"brand-text"],[1,"brand-highlights"],[1,"auth-panel"],[1,"auth-card"],[1,"form-header"],[1,"form-logo"],["src","https://upeu.edu.pe/wp-content/uploads/2022/04/logo-upeu-dark-svg.svg","alt","UPeU","onerror","this.style.display='none'",1,"main-logo"],[1,"welcome-question"],[1,"form-title"],[1,"step-indicator"],[1,"step-dot"],[1,"step-line"],["class","form-content",3,"formGroup","ngSubmit",4,"ngIf"],[1,"form-footer"],["href","#",1,"help-link"],[1,"brand-campus"],[4,"ngIf"],[1,"form-content",3,"ngSubmit","formGroup"],[1,"input-group"],["for","username"],["id","username","formControlName","username","autocomplete","username","placeholder","Ej. nombre.apellido"],["class","error-text",4,"ngIf"],["type","submit",1,"primary-btn",3,"disabled"],[1,"error-text"],[1,"user-info-simple"],[1,"user-avatar"],["alt","Foto de perfil",3,"src"],[1,"user-details"],[1,"user-name"],[1,"user-meta"],["type","button",1,"link-button","change-user",3,"click"],["class","lock-message",4,"ngIf"],["for","password"],[1,"password-wrapper"],["id","password","formControlName","password","autocomplete","current-password","placeholder","Ingresa tu contrase\xF1a",1,"password-input",3,"type","disabled"],["type","button","tabindex","-1",1,"toggle-password-btn",3,"click","disabled"],[1,"password-icon"],[1,"password-actions"],["href","#",1,"forgot-password",3,"click"],[1,"button-row"],["type","button",1,"secondary-btn",3,"click"],[1,"lock-message"],[1,"lock-icon"],[1,"lock-text"]],template:function(e,s){e&1&&(t(0,"div",0)(1,"div",1)(2,"aside",2),g(3,"img",3)(4,"div",4),t(5,"div",5)(6,"div",6),g(7,"img",7),p(8,B,2,0,"span",8)(9,Y,3,2,"span",8),n(),t(10,"h2",9),o(11," Plataforma de Vinculaci\xF3n con el Medio "),n(),t(12,"p",10),o(13," Accede a tus proyectos, eventos, registros y certificados en un solo lugar. "),n(),t(14,"ul",11)(15,"li"),o(16,"Gesti\xF3n de proyectos y eventos institucionales"),n(),t(17,"li"),o(18,"Control de asistencia y participaci\xF3n"),n(),t(19,"li"),o(20,"Integraci\xF3n con expedientes acad\xE9micos"),n()()()(),t(21,"main",12)(22,"div",13)(23,"header",14)(24,"div",15),g(25,"img",16),n(),t(26,"p",17),o(27,"\xBFListo para comenzar?"),n(),t(28,"h1",18),o(29),n(),t(30,"div",19)(31,"div",20),o(32,"1"),n(),g(33,"div",21),t(34,"div",20),o(35,"2"),n()()(),p(36,J,8,3,"form",22)(37,$,32,16,"form",22),t(38,"footer",23)(39,"p"),o(40," \xBFNecesitas ayuda? "),t(41,"a",24),o(42,"Cont\xE1ctanos"),n()()()()()()()),e&2&&(r(8),l("ngIf",s.step()===1),r(),l("ngIf",s.step()===2),r(20),P(s.title()),r(2),w("active",s.step()===1),r(3),w("active",s.step()===2),r(2),l("ngIf",s.step()===1),r(),l("ngIf",s.step()===2))},dependencies:[A,j,T,V,U,R,q,I],styles:['@charset "UTF-8";[_nghost-%COMP%]{display:block;height:100vh}.login-container[_ngcontent-%COMP%]{height:100vh;display:flex;justify-content:center;align-items:stretch;background:radial-gradient(circle at top left,#0f172a,#020617 55% 100%);font-family:Inter,Segoe UI,system-ui,-apple-system,sans-serif}.login-shell[_ngcontent-%COMP%]{width:100%;max-width:1120px;margin:1.5rem;display:flex;border-radius:1.5rem;overflow:hidden;box-shadow:0 28px 80px #0f172abf,0 0 0 1px #0f172ae6;background:#0f172ae6}.brand-panel[_ngcontent-%COMP%]{position:relative;flex:1.1;min-width:0;display:flex;align-items:flex-end;color:#f9fafb;overflow:hidden}.brand-background[_ngcontent-%COMP%]{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;transform:scale(1.02)}.brand-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:linear-gradient(135deg,#1e40aff2,#2563ebe6 28%,#3b82f6d9 55%,#0f172ae6)}.brand-content[_ngcontent-%COMP%]{position:relative;padding:2.5rem 2.75rem;width:100%}.brand-logo-row[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.75rem;margin-bottom:1.8rem}.brand-logo[_ngcontent-%COMP%]{height:46px;width:auto;display:block;filter:drop-shadow(0 2px 6px rgba(0,0,0,.4))}.brand-campus[_ngcontent-%COMP%]{padding:.25rem .75rem;border-radius:999px;background:#0f172a4d;border:1px solid rgba(248,250,252,.35);font-size:.78rem;letter-spacing:.08em;text-transform:uppercase}.brand-title[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:700;margin:0 0 .75rem;line-height:1.25}.brand-text[_ngcontent-%COMP%]{margin:0 0 1.5rem;font-size:.95rem;color:#f1f5f9e6;max-width:26rem}.brand-highlights[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0;display:grid;gap:.65rem;font-size:.9rem}.brand-highlights[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem}.brand-highlights[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:before{content:"";width:.35rem;height:.35rem;border-radius:999px;background:#60a5fa}.auth-panel[_ngcontent-%COMP%]{flex:1;min-width:0;background:#f3f4f6;display:flex;align-items:center;justify-content:center;padding:1.75rem}.auth-card[_ngcontent-%COMP%]{width:100%;max-width:420px;background:#fff;border-radius:1.25rem;padding:2.25rem 2.25rem 2rem;box-shadow:0 20px 60px #0f172a2e,0 0 0 1px #0f172a05}.form-header[_ngcontent-%COMP%]{text-align:left;margin-bottom:1.75rem}.form-logo[_ngcontent-%COMP%]{margin-bottom:1.25rem}.form-logo[_ngcontent-%COMP%]   .main-logo[_ngcontent-%COMP%]{height:40px;width:auto;display:block}.welcome-question[_ngcontent-%COMP%]{margin:0 0 .25rem;font-size:.95rem;color:#6b7280}.form-title[_ngcontent-%COMP%]{margin:0;font-size:1.6rem;font-weight:700;color:#111827}.step-indicator[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.5rem;margin-top:1.25rem}.step-dot[_ngcontent-%COMP%]{width:1.8rem;height:1.8rem;border-radius:999px;border:1px solid #e5e7eb;font-size:.85rem;display:flex;align-items:center;justify-content:center;color:#6b7280;background:#f9fafb;font-weight:500;transition:all .25s ease}.step-dot.active[_ngcontent-%COMP%]{border-color:#1d4ed8;background:#1d4ed8;color:#f9fafb;box-shadow:0 0 0 3px #2563eb33}.step-line[_ngcontent-%COMP%]{flex:1;height:2px;border-radius:999px;background:linear-gradient(to right,#d1d5dbe6,#d1d5db33)}.form-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1.5rem}.input-group[_ngcontent-%COMP%]{display:flex;flex-direction:column}.input-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:#374151;margin-bottom:.4rem}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;border-radius:.75rem;border:1px solid #d1d5db;padding:.85rem 1rem;font-size:.95rem;transition:all .2s ease;background:#f9fafb}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#1d4ed8;box-shadow:0 0 0 1px #1d4ed8,0 0 0 4px #3b82f640;background:#fff}.error-text[_ngcontent-%COMP%]{margin-top:.35rem;font-size:.78rem;color:#b91c1c}.user-info-simple[_ngcontent-%COMP%]{display:flex;align-items:center;gap:.85rem;padding:.9rem 1rem;border-radius:.9rem;background:#f9fafb;border:1px solid #e5e7eb}.user-avatar[_ngcontent-%COMP%]{width:2.7rem;height:2.7rem;border-radius:999px;overflow:hidden;flex-shrink:0;background:#e5e7eb;display:flex;align-items:center;justify-content:center;font-weight:600;color:#374151}.user-avatar[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;object-fit:cover}.user-details[_ngcontent-%COMP%]{flex:1;min-width:0}.user-name[_ngcontent-%COMP%]{font-size:.95rem;font-weight:600;color:#111827;margin-bottom:.05rem}.user-meta[_ngcontent-%COMP%]{font-size:.8rem;color:#6b7280}.link-button.change-user[_ngcontent-%COMP%]{margin-left:auto;border:none;background:transparent;font-size:.78rem;font-weight:500;color:#1d4ed8;cursor:pointer;padding:0;text-decoration:underline}.lock-message[_ngcontent-%COMP%]{display:flex;gap:.8rem;padding:.85rem 1rem;border-radius:.9rem;background:#fef2f2;border:1px solid #fecaca}.lock-icon[_ngcontent-%COMP%]{width:2.2rem;height:2.2rem;border-radius:999px;background:#fee2e2;display:flex;align-items:center;justify-content:center}.lock-icon[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-size:1.1rem}.lock-text[_ngcontent-%COMP%]   strong[_ngcontent-%COMP%]{display:block;font-size:.9rem;margin-bottom:.1rem;color:#991b1b}.lock-text[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.8rem;color:#b91c1c}.password-wrapper[_ngcontent-%COMP%]{position:relative;display:flex;align-items:center}.password-wrapper[_ngcontent-%COMP%]   .password-input[_ngcontent-%COMP%]{width:100%;border-radius:.75rem;border:1px solid #d1d5db;padding:.85rem 2.7rem .85rem 1rem;font-size:.95rem;background:#f9fafb;transition:all .2s ease}.password-wrapper[_ngcontent-%COMP%]   .password-input[_ngcontent-%COMP%]::placeholder{color:#9ca3af}.password-wrapper[_ngcontent-%COMP%]   .password-input[_ngcontent-%COMP%]:focus{outline:none;border-color:#1d4ed8;box-shadow:0 0 0 1px #1d4ed8,0 0 0 4px #3b82f640;background:#fff}.password-wrapper[_ngcontent-%COMP%]   .password-input.error[_ngcontent-%COMP%]{border-color:#b91c1c;box-shadow:0 0 0 1px #b91c1c1f}.toggle-password-btn[_ngcontent-%COMP%]{position:absolute;right:.6rem;border:none;background:transparent;cursor:pointer;padding:.25rem;border-radius:999px;display:flex;align-items:center;justify-content:center}.toggle-password-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#f3f4f6}.toggle-password-btn[_ngcontent-%COMP%]:disabled{cursor:default;opacity:.4}.password-icon[_ngcontent-%COMP%]{font-size:1rem}.password-actions[_ngcontent-%COMP%]{margin-top:.4rem;display:flex;justify-content:flex-end}.password-actions[_ngcontent-%COMP%]   .forgot-password[_ngcontent-%COMP%]{font-size:.8rem;color:#6b7280;text-decoration:none}.password-actions[_ngcontent-%COMP%]   .forgot-password[_ngcontent-%COMP%]:hover{color:#1d4ed8;text-decoration:underline}.primary-btn[_ngcontent-%COMP%], .secondary-btn[_ngcontent-%COMP%]{border-radius:.75rem;padding:.85rem 1.1rem;font-size:.95rem;font-weight:600;border:none;cursor:pointer;transition:all .2s ease}.primary-btn[_ngcontent-%COMP%]{background:#1d4ed8;color:#f9fafb;width:100%;text-align:center}.primary-btn[_ngcontent-%COMP%]:hover:not(:disabled){background:#1e40af;box-shadow:0 12px 30px #2563eb59;transform:translateY(-1px)}.primary-btn[_ngcontent-%COMP%]:disabled{background:#e5e7eb;color:#9ca3af;box-shadow:none;cursor:default}.secondary-btn[_ngcontent-%COMP%]{background:#f9fafb;color:#374151;border:1px solid #d1d5db}.secondary-btn[_ngcontent-%COMP%]:hover{background:#f3f4f6}.button-row[_ngcontent-%COMP%]{display:flex;gap:.75rem}.button-row[_ngcontent-%COMP%]   .secondary-btn[_ngcontent-%COMP%], .button-row[_ngcontent-%COMP%]   .primary-btn[_ngcontent-%COMP%]{flex:1}.form-footer[_ngcontent-%COMP%]{margin-top:1.75rem;padding-top:1.25rem;border-top:1px solid #e5e7eb;text-align:center}.form-footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.85rem;color:#6b7280}.form-footer[_ngcontent-%COMP%]   .help-link[_ngcontent-%COMP%]{color:#1d4ed8;font-weight:500;text-decoration:none}.form-footer[_ngcontent-%COMP%]   .help-link[_ngcontent-%COMP%]:hover{text-decoration:underline}.link-button[_ngcontent-%COMP%]{background:none;border:none;padding:0;cursor:pointer}@media (max-width: 960px){.login-container[_ngcontent-%COMP%]{height:auto;align-items:center}.login-shell[_ngcontent-%COMP%]{flex-direction:column;max-width:480px;margin:1.5rem 1rem}.brand-panel[_ngcontent-%COMP%]{height:180px}.brand-content[_ngcontent-%COMP%]{padding:1.5rem}.auth-panel[_ngcontent-%COMP%]{padding:1.25rem}.auth-card[_ngcontent-%COMP%]{padding:1.9rem 1.6rem 1.8rem}}@media (max-width: 480px){.auth-card[_ngcontent-%COMP%]{border-radius:1rem}.form-title[_ngcontent-%COMP%]{font-size:1.4rem}.brand-panel[_ngcontent-%COMP%]{height:160px}}']});var G=h;export{G as LoginPage};
