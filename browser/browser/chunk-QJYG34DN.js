import{a as z}from"./chunk-3UUQ5E6N.js";import{a as H}from"./chunk-OKPZKVFZ.js";import"./chunk-LWNR2F3M.js";import{i as N,j as A,k as D,u as O}from"./chunk-FE5WSVYG.js";import{$ as u,$a as i,Hb as j,Ka as C,Ob as M,Pa as g,T as I,Tb as k,Y as x,Z as _,_ as c,_a as l,ab as n,bb as d,eb as T,fa as b,fb as V,gb as v,kb as h,mb as m,n as y,rb as E,vb as a,wb as w,xb as S,ya as o,yb as L}from"./chunk-63T4HJ2B.js";import"./chunk-IMPBB4AK.js";var G=(r,t)=>({"bg-emerald-500":r,"bg-gray-300":t});function $(r,t){if(r&1&&(i(0,"div",21),c(),i(1,"svg",22),d(2,"path",23),n(),u(),i(3,"span"),a(4),n()()),r&2){let e=m();o(4),w(e.errorMsg())}}function B(r,t){r&1&&(i(0,"div",24)(1,"div",25),d(2,"div",26),i(3,"div",27),c(),i(4,"svg",8),d(5,"path",28),n()()(),u(),i(6,"p",29),a(7," Cargando sesiones activas... "),n()())}function q(r,t){r&1&&(i(0,"span",58),a(1," Esta sesi\xF3n "),n())}function R(r,t){if(r&1&&(i(0,"span",59),a(1),n()),r&2){let e=m().$implicit,s=m(3);o(),S(" ID: ",s.shortId(e)," ")}}function W(r,t){if(r&1&&(i(0,"span",50),c(),i(1,"svg",51),d(2,"path",60)(3,"path",61),n(),a(4),n()),r&2){let e=m().$implicit;o(4),S(" IP ",e.ip_address," ")}}function J(r,t){if(r&1&&(i(0,"div",62),a(1),n()),r&2){let e=m().$implicit;o(),S(" ",e.user_agent," ")}}function K(r,t){r&1&&(i(0,"span"),a(1," Cerrar sesi\xF3n "),n())}function Q(r,t){r&1&&(i(0,"span"),a(1," Cerrando... "),n())}function U(r,t){if(r&1){let e=v();i(0,"button",63),h("click",function(){x(e);let p=m().$implicit,P=m(3);return _(P.cerrarSesion(p))}),c(),i(1,"svg",17),d(2,"path",64),n(),g(3,K,2,0,"span",65)(4,Q,2,0,"span",65),n()}if(r&2){let e=m().$implicit,s=m(3);l("disabled",s.loading()||s.actionSessionId()===e.id),o(3),l("ngIf",s.actionSessionId()!==e.id),o(),l("ngIf",s.actionSessionId()===e.id)}}function X(r,t){r&1&&(i(0,"span",66),d(1,"span",67),a(2," Sesi\xF3n actual "),n())}function Y(r,t){if(r&1&&(i(0,"div",37)(1,"div",38)(2,"div",39)(3,"div",40),c(),i(4,"svg",41),d(5,"path",42),n()(),u(),i(6,"div",43)(7,"div",44)(8,"span",45),a(9),n(),g(10,q,2,0,"span",46)(11,R,2,1,"span",47),n(),i(12,"div",48),g(13,W,5,1,"span",49),i(14,"span",50),c(),i(15,"svg",51),d(16,"path",28),n(),a(17," \xDAltima actividad: "),u(),i(18,"span",52),a(19),n()(),i(20,"span",50),c(),i(21,"svg",51),d(22,"path",53),n(),a(23," Inicio: "),u(),i(24,"span",52),a(25),n()()(),g(26,J,2,1,"div",54),n()(),i(27,"div",55),g(28,U,5,3,"button",56)(29,X,3,0,"span",57),n()()()),r&2){let e=t.$implicit,s=m(3);o(9),L(" ",s.deviceLabel(e)," \xB7 ",s.browserLabel(e)," "),o(),l("ngIf",e.is_current),o(),l("ngIf",!e.is_current),o(2),l("ngIf",e.ip_address),o(6),w(s.lastActivityLabel(e)),o(6),w(s.createdAtLabel(e)),o(),l("ngIf",e.user_agent),o(2),l("ngIf",!e.is_current),o(),l("ngIf",e.is_current)}}function Z(r,t){if(r&1){let e=v();T(0),i(1,"div",31)(2,"div",32)(3,"div",33),a(4," Estas son las sesiones donde tu cuenta est\xE1 activa. "),n(),i(5,"button",34),h("click",function(){x(e);let p=m(2);return _(p.reload())}),c(),i(6,"svg",17),d(7,"path",35),n(),a(8," Actualizar "),n()(),g(9,Y,30,10,"div",36),n(),V()}if(r&2){let e=m(2);o(5),l("disabled",e.loading()),o(4),l("ngForOf",e.sessions())}}function ee(r,t){if(r&1&&g(0,Z,10,2,"ng-container",30),r&2){let e=m(),s=E(27);l("ngIf",e.sessions().length>0)("ngIfElse",s)}}function te(r,t){if(r&1){let e=v();i(0,"div",68)(1,"div",69),c(),i(2,"svg",70),d(3,"path",71),n()(),u(),i(4,"h2",72),a(5," No hay sesiones registradas "),n(),i(6,"p",73),a(7," Por ahora no se encontraron sesiones activas asociadas a tu cuenta. "),n(),i(8,"button",74),h("click",function(){x(e);let p=m();return _(p.reload())}),c(),i(9,"svg",17),d(10,"path",35),n(),a(11," Volver a intentar "),n()()}}var f=class f{constructor(){this.perfilApi=I(z);this.loader=I(H);this.loading=b(!0);this.errorMsg=b(null);this.sessions=b([]);this.actionSessionId=b(null);this.totalSessions=k(()=>this.sessions().length);this.currentSession=k(()=>this.sessions().find(t=>t.is_current)??null);this.hasOtherSessions=k(()=>this.sessions().some(t=>!t.is_current))}ngOnInit(){this.reload()}async reload(){this.loading.set(!0),this.errorMsg.set(null);try{let t=await y(this.loader.track(this.perfilApi.listSessions(),"Cargando sesiones de inicio de sesi\xF3n..."));t.ok?this.sessions.set(t.sessions??[]):(this.errorMsg.set(t.message||"Error al cargar las sesiones"),this.sessions.set([]))}catch(t){console.error(t),this.errorMsg.set("No se pudieron cargar las sesiones"),this.sessions.set([])}finally{this.loading.set(!1),this.actionSessionId.set(null)}}async cerrarSesion(t){if(!(t.is_current||!window.confirm("\xBFSeguro que quieres cerrar esta sesi\xF3n en particular?"))){this.actionSessionId.set(t.id),this.errorMsg.set(null);try{let s=await y(this.loader.track(this.perfilApi.revokeSession(t.id),"Cerrando sesi\xF3n..."));s.ok?await this.reload():this.errorMsg.set(s.message||"No se pudo cerrar la sesi\xF3n seleccionada")}catch(s){console.error(s),this.errorMsg.set("Error al cerrar la sesi\xF3n")}finally{this.actionSessionId.set(null)}}}async cerrarOtrasSesiones(){if(!(!this.hasOtherSessions()||!window.confirm("Se cerrar\xE1n todas tus otras sesiones en otros dispositivos/navegadores. \xBFContinuar?"))){this.loading.set(!0),this.errorMsg.set(null);try{let e=await y(this.loader.track(this.perfilApi.revokeOtherSessions(),"Cerrando otras sesiones..."));e.ok?await this.reload():this.errorMsg.set(e.message||"No se pudieron cerrar las otras sesiones")}catch(e){console.error(e),this.errorMsg.set("Error al cerrar las otras sesiones")}finally{this.loading.set(!1)}}}shortId(t){return t.id?t.id.length<=10?t.id:`${t.id.slice(0,6)}\u2026${t.id.slice(-4)}`:""}lastActivityLabel(t){return t.last_activity||"\u2014"}createdAtLabel(t){return t.created_at||t.last_activity||"\u2014"}deviceLabel(t){if(!t.user_agent)return"Dispositivo desconocido";let e=t.user_agent.toLowerCase();return e.includes("mobile")?"M\xF3vil":e.includes("tablet")?"Tablet":e.includes("windows")?"PC \xB7 Windows":e.includes("mac os")||e.includes("macintosh")?"Mac":e.includes("linux")?"PC \xB7 Linux":"Dispositivo"}browserLabel(t){let e=(t.user_agent||"").toLowerCase();return e.includes("chrome")&&!e.includes("edge")&&!e.includes("opr")?"Chrome":e.includes("edg/")?"Edge":e.includes("firefox")?"Firefox":e.includes("safari")&&!e.includes("chrome")?"Safari":e.includes("opr")||e.includes("opera")?"Opera":"Navegador"}};f.\u0275fac=function(e){return new(e||f)},f.\u0275cmp=C({type:f,selectors:[["app-perfil-sessions-page"]],decls:28,vars:9,consts:[["sessionsTpl",""],["emptyTpl",""],[1,"min-h-screen","bg-gradient-to-br","from-slate-50","to-emerald-50/30","py-8"],[1,"mx-auto","max-w-5xl","px-4"],[1,"mb-8","flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-4"],[1,"space-y-2"],[1,"flex","items-center","gap-3"],[1,"p-2","bg-white/80","backdrop-blur-sm","rounded-xl","shadow-sm","border","border-white/60","shadow-emerald-100/50"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-emerald-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0z"],[1,"text-3xl","font-bold","bg-gradient-to-r","from-gray-900","to-emerald-700","bg-clip-text","text-transparent"],[1,"text-gray-600","text-sm","flex","items-center","gap-2"],[1,"w-2","h-2","bg-gradient-to-r","from-emerald-500","to-teal-400","rounded-full","animate-pulse"],[1,"flex","flex-col","sm:items-end","gap-2"],[1,"px-3","py-1.5","rounded-full","bg-white/80","backdrop-blur-sm","border","border-white/60","text-xs","text-gray-600","flex","items-center","gap-2"],[1,"w-2","h-2","rounded-full",3,"ngClass"],["type","button",1,"inline-flex","items-center","gap-2","px-4","py-2","rounded-lg","border","border-red-200","bg-red-50","text-red-700","text-sm","font-medium","hover:bg-red-100","hover:border-red-300","disabled:opacity-60","disabled:cursor-not-allowed","transition-all","duration-300",3,"click","disabled"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 13h6m-7 8h8a2 2 0 002-2v-3H5v3a2 2 0 002 2zM9 6h6m-7 8h8a2 2 0 002-2V5a2 2 0 00-2-2H9a2 2 0 00-2 2v7a2 2 0 002 2z"],["class","mb-6 p-4 rounded-xl bg-gradient-to-r from-red-50 to-red-100/50 text-red-700 border border-red-200 backdrop-blur-sm flex items-center gap-3",4,"ngIf"],["class","flex flex-col justify-center items-center py-16 bg-white/80 backdrop-blur-sm rounded-2xl border border-white/60 shadow-sm",4,"ngIf","ngIfElse"],[1,"mb-6","p-4","rounded-xl","bg-gradient-to-r","from-red-50","to-red-100/50","text-red-700","border","border-red-200","backdrop-blur-sm","flex","items-center","gap-3"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"flex","flex-col","justify-center","items-center","py-16","bg-white/80","backdrop-blur-sm","rounded-2xl","border","border-white/60","shadow-sm"],[1,"relative"],[1,"animate-spin","rounded-full","h-14","w-14","border-b-2","border-emerald-600"],[1,"absolute","top-1/2","left-1/2","transform","-translate-x-1/2","-translate-y-1/2"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"mt-4","text-gray-600","font-medium"],[4,"ngIf","ngIfElse"],[1,"bg-white/80","backdrop-blur-sm","rounded-2xl","border","border-white/60","shadow-sm","divide-y","divide-gray-100"],[1,"px-4","py-3","flex","items-center","justify-between"],[1,"text-sm","text-gray-600"],["type","button",1,"inline-flex","items-center","gap-2","px-3","py-1.5","rounded-lg","border","border-gray-200","bg-gray-50","text-xs","text-gray-700","hover:bg-white","hover:border-gray-300","disabled:opacity-60","transition-all","duration-200",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"],["class","px-4 py-4",4,"ngFor","ngForOf"],[1,"px-4","py-4"],[1,"flex","flex-col","sm:flex-row","sm:items-center","gap-3"],[1,"flex-1","flex","items-start","gap-3"],[1,"mt-1","w-9","h-9","rounded-full","bg-gradient-to-br","from-emerald-100","to-teal-100","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5","text-emerald-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9.75 17L9 20l-1 1h8l-1-1-.75-3M9 13h6a3 3 0 10-6 0z"],[1,"space-y-1"],[1,"flex","items-center","gap-2","flex-wrap"],[1,"font-semibold","text-gray-800"],["class","text-xs px-2 py-0.5 rounded-full bg-emerald-100 text-emerald-800 border border-emerald-200 font-semibold",4,"ngIf"],["class","text-[11px] px-2 py-0.5 rounded-full bg-slate-100 text-slate-700 border border-slate-200",4,"ngIf"],[1,"text-xs","text-gray-500","flex","flex-wrap","items-center","gap-x-3","gap-y-1"],["class","inline-flex items-center gap-1",4,"ngIf"],[1,"inline-flex","items-center","gap-1"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-3.5","h-3.5"],[1,"font-medium"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3m-4 4v14m-7-5h14"],["class","text-[11px] text-gray-400 mt-1 line-clamp-2",4,"ngIf"],[1,"shrink-0","flex","items-center","gap-2"],["type","button","class","inline-flex items-center gap-2 px-3 py-1.5 rounded-lg border border-gray-200 bg-white text-xs font-medium text-gray-700 hover:bg-gray-50 hover:border-gray-300 disabled:opacity-60 disabled:cursor-not-allowed transition-all duration-200",3,"disabled","click",4,"ngIf"],["class","inline-flex items-center gap-1 px-3 py-1.5 rounded-lg border border-emerald-200 bg-emerald-50 text-xs font-semibold text-emerald-700",4,"ngIf"],[1,"text-xs","px-2","py-0.5","rounded-full","bg-emerald-100","text-emerald-800","border","border-emerald-200","font-semibold"],[1,"text-[11px]","px-2","py-0.5","rounded-full","bg-slate-100","text-slate-700","border","border-slate-200"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 11c0-1.657-1.343-3-3-3S6 9.343 6 11s1.343 3 3 3 3-1.343 3-3z"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 11c0-1.657 1.343-3 3-3s3 1.343 3 3-1.343 3-3 3-3-1.343-3-3z"],[1,"text-[11px]","text-gray-400","mt-1","line-clamp-2"],["type","button",1,"inline-flex","items-center","gap-2","px-3","py-1.5","rounded-lg","border","border-gray-200","bg-white","text-xs","font-medium","text-gray-700","hover:bg-gray-50","hover:border-gray-300","disabled:opacity-60","disabled:cursor-not-allowed","transition-all","duration-200",3,"click","disabled"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 12H9m0 0l3-3m-3 3l3 3m-6 4h12a2 2 0 002-2V9a2 2 0 00-2-2h-5.5a1 1 0 01-.707-.293l-1.5-1.5A1 1 0 0011.086 5H6A2 2 0 004 7v9a2 2 0 002 2z"],[4,"ngIf"],[1,"inline-flex","items-center","gap-1","px-3","py-1.5","rounded-lg","border","border-emerald-200","bg-emerald-50","text-xs","font-semibold","text-emerald-700"],[1,"w-2","h-2","rounded-full","bg-emerald-500","animate-pulse"],[1,"text-center","py-16","bg-white/80","backdrop-blur-sm","rounded-2xl","shadow-sm","border","border-white/60"],[1,"w-16","h-16","mx-auto","mb-4","rounded-full","bg-gradient-to-r","from-emerald-100","to-teal-100","flex","items-center","justify-center"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-9","h-9","text-emerald-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 13h6m-3-3v6m9-4a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-lg","font-semibold","text-gray-800","mb-1"],[1,"text-gray-600","text-sm","max-w-md","mx-auto","mb-4"],["type","button",1,"px-5","py-2.5","rounded-lg","bg-gradient-to-r","from-emerald-600","to-teal-600","text-white","text-sm","font-medium","hover:from-emerald-700","hover:to-teal-700","transition-all","duration-300","shadow-sm","hover:shadow-md","inline-flex","items-center","gap-2",3,"click"]],template:function(e,s){if(e&1){let p=v();i(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7),c(),i(6,"svg",8),d(7,"path",9),n()(),u(),i(8,"div")(9,"h1",10),a(10," Sesiones de inicio de sesi\xF3n "),n(),i(11,"p",11),d(12,"span",12),a(13," Revisa en qu\xE9 dispositivos tienes la cuenta abierta y cierra los que no reconozcas. "),n()()()(),i(14,"div",13)(15,"div",14),d(16,"span",15),a(17),n(),i(18,"button",16),h("click",function(){return x(p),_(s.cerrarOtrasSesiones())}),c(),i(19,"svg",17),d(20,"path",18),n(),a(21," Cerrar otras sesiones "),n()()(),g(22,$,5,1,"div",19)(23,B,8,0,"div",20)(24,ee,1,2,"ng-template",null,0,M)(26,te,12,0,"ng-template",null,1,M),n()()}if(e&2){let p=E(25);o(16),l("ngClass",j(6,G,s.totalSessions()>0,s.totalSessions()===0)),o(),S(" ",s.totalSessions()," sesiones detectadas "),o(),l("disabled",!s.hasOtherSessions()||s.loading()),o(4),l("ngIf",s.errorMsg()),o(),l("ngIf",s.loading())("ngIfElse",p)}},dependencies:[O,N,A,D],encapsulation:2});var F=f;export{F as PerfilSessionsPage};
