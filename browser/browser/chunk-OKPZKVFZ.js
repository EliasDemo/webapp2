import{A as a,O as r,fa as i}from"./chunk-63T4HJ2B.js";var t=class t{constructor(){this.DEFAULT_MESSAGE="Procesando solicitud...";this.MAX_VISIBLE_MS=45e3;this._visible=i(!1);this._message=i(this.DEFAULT_MESSAGE);this._progress=i(0);this.activeRequests=0;this.messagesStack=[];this.visible=this._visible.asReadonly();this.message=this._message.asReadonly();this.progress=this._progress.asReadonly()}show(s){this.activeRequests++,s?(this.messagesStack.push(s),this._message.set(s)):this.messagesStack.length?this._message.set(this.messagesStack[this.messagesStack.length-1]):this._message.set(this.DEFAULT_MESSAGE),this._visible()||this._visible.set(!0),this._progress.set(0),this.startProgressSimulation(),this.startWatchdog()}hide(s=!1){if(s?(this.activeRequests=0,this.messagesStack=[]):this.activeRequests>0&&(this.activeRequests--,this.messagesStack.length&&this.messagesStack.pop()),this.activeRequests===0)this._progress.set(100),this.clearWatchdog(),this.stopProgressSimulation(),setTimeout(()=>{this._visible.set(!1),this._progress.set(0),this._message.set(this.DEFAULT_MESSAGE)},250);else{let e=this.messagesStack[this.messagesStack.length-1]??this.DEFAULT_MESSAGE;this._message.set(e)}}setProgress(s){let e=Math.min(100,Math.max(0,Math.round(s)));this._progress.set(e)}track(s,e){return this.show(e),s.pipe(a(()=>this.hide()))}reset(){this.activeRequests=0,this.messagesStack=[],this.clearWatchdog(),this.stopProgressSimulation(),this._visible.set(!1),this._progress.set(0),this._message.set(this.DEFAULT_MESSAGE)}register(s){}getProgress(){return this.progress}startProgressSimulation(){this.progressInterval||(this.progressInterval=setInterval(()=>{let s=this._progress();if(s>=90)return;let e=Math.max(1,Math.round((100-s)*.07));this._progress.set(s+e)},400))}stopProgressSimulation(){this.progressInterval&&(clearInterval(this.progressInterval),this.progressInterval=void 0)}startWatchdog(){this.clearWatchdog(),this.watchdogTimeout=setTimeout(()=>{this._visible()&&(console.warn("[LoaderService] Auto-hide del loader por timeout"),this.hide(!0))},this.MAX_VISIBLE_MS)}clearWatchdog(){this.watchdogTimeout&&(clearTimeout(this.watchdogTimeout),this.watchdogTimeout=void 0)}};t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r({token:t,factory:t.\u0275fac,providedIn:"root"});var o=t;export{o as a};
