import{a as Q}from"./chunk-ZHWJTMU2.js";import{A as G,a as U,b as z,d as B,i as J,k as K,u as Y,v as q}from"./chunk-J2XPQYKK.js";import"./chunk-LWNR2F3M.js";import{g as j,j as O}from"./chunk-5VQTM22E.js";import{i as T,j as F,k as N,r as A,u as L}from"./chunk-FE5WSVYG.js";import{$a as t,Ka as R,Kb as M,Lb as P,Ob as D,Pa as b,T as k,Tb as w,Y as x,Z as u,_a as s,ab as e,bb as d,eb as C,fa as f,fb as V,gb as I,kb as g,mb as h,rb as y,tb as H,vb as i,wb as _,xb as v,ya as n}from"./chunk-63T4HJ2B.js";import"./chunk-IMPBB4AK.js";function X(o,l){if(o&1){let a=I();t(0,"div",63)(1,"div",64)(2,"div",65),d(3,"i",66),e(),t(4,"div",67)(5,"div",68),i(6,"Ocurri\xF3 un problema"),e(),t(7,"div",69),i(8),e()(),t(9,"button",70),g("click",function(){x(a);let p=h();return u(p.error.set(null))}),d(10,"i",71),e()()()}if(o&2){let a=h();n(8),_(a.error())}}function Z(o,l){o&1&&(C(0),i(1," Ya existen registros hist\xF3ricos para esta EP-SEDE. "),V())}function $(o,l){o&1&&i(0," A\xFAn no se han registrado horas hist\xF3ricas para esta EP-SEDE. ")}function ee(o,l){if(o&1&&(t(0,"div",72)(1,"div",73)(2,"div",74),i(3,"EP-SEDE resuelta"),e(),t(4,"div",75),i(5),e()(),t(6,"div",76)(7,"div",74),i(8,"Horas hist\xF3ricas"),e(),t(9,"div",77),b(10,Z,2,0,"ng-container",78)(11,$,1,0,"ng-template",null,1,D),e()()()),o&2){let a,r,p,c,m=y(12),S=h();n(5),v(" ",((a=S.status())==null?null:a.ep_sede_id)??"\u2014"," "),n(),s("ngClass",(r=S.status())!=null&&r.has_horas?"bg-emerald-50":"bg-slate-50"),n(3),s("ngClass",(p=S.status())!=null&&p.has_horas?"text-emerald-700":"text-slate-700"),n(),s("ngIf",(c=S.status())==null?null:c.has_horas)("ngIfElse",m)}}function te(o,l){if(o&1&&(t(0,"div",79),i(1," Seleccionado: "),t(2,"b"),i(3),e()()),o&2){let a,r=h();n(3),_((a=r.file())==null?null:a.name)}}function ie(o,l){o&1&&d(0,"i",80)}function re(o,l){if(o&1&&(t(0,"div",86)(1,"div",87)(2,"div",88),i(3),e(),t(4,"div",89),i(5,"Filas con datos"),e()(),t(6,"div",90)(7,"div",91),i(8),e(),t(9,"div",92),i(10,"Targets (proy./slots)"),e()(),t(11,"div",93)(12,"div",94),i(13),e(),t(14,"div",95),i(15,"Asistencias upsert"),e()(),t(16,"div",96)(17,"div",97),i(18),e(),t(19,"div",98),i(20,"Errores"),e()()()),o&2){let a,r,p,c,m=h(2);n(3),v(" ",((a=m.summary())==null?null:a.processed_rows)??0," "),n(5),v(" ",((r=m.summary())==null?null:r.targets)??0," "),n(5),v(" ",((p=m.summary())==null?null:p.asistencias_upserted)??0," "),n(5),v(" ",((c=m.summary())==null?null:c.errors)??0," ")}}function ae(o,l){if(o&1&&(t(0,"tr",108)(1,"td",109),i(2),e(),t(3,"td",110),i(4),e(),t(5,"td",109),i(6),e(),t(7,"td",109)(8,"code",111),i(9),M(10,"json"),e()()()),o&2){let a=l.$implicit;n(2),_(a.row??"\u2014"),n(2),_(a.codigo??"\u2014"),n(2),_(a.reason??"\u2014"),n(3),v(" ",P(10,4,a)," ")}}function ne(o,l){if(o&1&&(t(0,"div",99)(1,"div",100)(2,"div",101),d(3,"i",102),i(4," Detalle de errores "),e(),t(5,"div",33),i(6),e()(),t(7,"div",103)(8,"table",104)(9,"thead",105)(10,"tr")(11,"th",106),i(12,"Fila"),e(),t(13,"th",106),i(14,"C\xF3digo"),e(),t(15,"th",106),i(16,"Motivo"),e(),t(17,"th",106),i(18,"Extra"),e()()(),t(19,"tbody"),b(20,ae,11,6,"tr",107),e()()()()),o&2){let a=h(2);n(6),v(" ",a.errores().length," filas con problemas "),n(14),s("ngForOf",a.errores())("ngForTrackBy",a.trackError)}}function oe(o,l){if(o&1&&(t(0,"section",81)(1,"div",36)(2,"div",82),d(3,"i",83),e(),t(4,"div")(5,"h2",25),i(6,"Resumen de importaci\xF3n"),e(),t(7,"p",26),i(8," Revisa filas procesadas, asistencias creadas y errores por fila. "),e()()(),b(9,re,21,4,"div",84)(10,ne,21,3,"div",85),e()),o&2){let a=h();n(9),s("ngIf",a.summary()),n(),s("ngIf",a.errores().length)}}function le(o,l){o&1&&(t(0,"div",112)(1,"div",113)(2,"div",114),d(3,"div",115)(4,"div",116),e(),t(5,"div",117),i(6,"Procesando"),e(),t(7,"div",118),i(8," Esto puede tomar unos segundos\u2026 "),e()()())}var E=class E{constructor(){this.rpApi=k(Q);this.loading=f(!1);this.error=f(null);this.epSedeId=f(null);this.replace=f(!1);this.ultimos=f(6);this.file=f(null);this.status=f(null);this.summary=f(null);this.errores=f([]);this.hasStatus=w(()=>!!this.status());this.hasResultado=w(()=>!!this.summary()||this.errores().length>0);this.trackError=(l,a)=>a.row??a.codigo??a.reason??Math.random();this.cargarStatus()}onFileChange(l){let r=l.target.files;this.file.set(r&&r.length?r[0]:null)}cargarStatus(){this.loading.set(!0),this.error.set(null),this.rpApi.consultarEstadoHorasHistoricas(this.epSedeId()??void 0).subscribe({next:l=>{this.status.set(l)},error:l=>{this.error.set(l?.error?.message||"No se pudo obtener el estado de horas hist\xF3ricas.")},complete:()=>this.loading.set(!1)})}descargarPlantilla(){this.loading.set(!0),this.error.set(null),this.rpApi.descargarPlantillaHorasHistoricas({ultimos:this.ultimos()}).subscribe({next:l=>{let a=URL.createObjectURL(l),r=document.createElement("a");r.href=a,r.download="plantilla_horas_historicas.xlsx",document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(a)},error:l=>{this.error.set(l?.error?.message||"No se pudo descargar la plantilla.")},complete:()=>this.loading.set(!1)})}importar(){let l=this.file();if(!l){this.error.set("Selecciona un archivo Excel antes de importar.");return}this.loading.set(!0),this.error.set(null),this.summary.set(null),this.errores.set([]),this.rpApi.importarHorasHistoricas(l,{ep_sede_id:this.epSedeId()??void 0,replace:this.replace()}).subscribe({next:a=>{a.ok||this.error.set("La importaci\xF3n devolvi\xF3 un estado no OK."),this.summary.set(a.summary??null),this.errores.set(a.errors??[])},error:a=>{this.error.set(a?.error?.message||"No se pudo completar la importaci\xF3n.")},complete:()=>{this.loading.set(!1),this.cargarStatus()}})}limpiarResultado(){this.summary.set(null),this.errores.set([]),this.error.set(null),this.file.set(null)}};E.\u0275fac=function(a){return new(a||E)},E.\u0275cmp=R({type:E,selectors:[["rp-import-historico-horas-page"]],decls:107,vars:18,consts:[["fileInput",""],["noHoras",""],[1,"min-h-screen","bg-gradient-to-br","from-slate-50","to-blue-50/30","pb-16"],[1,"border-b","border-slate-200","bg-white/80","backdrop-blur-sm","sticky","top-0","z-10"],[1,"max-w-7xl","mx-auto","px-4","py-4"],[1,"flex","items-center","justify-between","gap-4"],[1,"flex","items-center","gap-3"],[1,"p-2","rounded-xl","bg-emerald-100","text-emerald-700"],[1,"fa-solid","fa-file-excel","text-lg"],[1,"text-xs","text-slate-500","mb-1","flex","items-center","gap-1"],["routerLink","/",1,"hover:text-slate-700","font-medium","transition-colors"],[1,"fa-solid","fa-chevron-right","text-[10px]","text-slate-400"],["routerLink","/r/horas",1,"hover:text-slate-700","font-medium","transition-colors"],[1,"text-emerald-700","font-semibold"],[1,"text-2xl","font-bold","text-slate-900"],[1,"text-sm","text-slate-600","mt-1"],[1,"flex","items-center","gap-2"],["routerLink","/r/horas",1,"inline-flex","items-center","gap-2","rounded-xl","border","border-slate-300","bg-white","px-4","py-2","text-sm","font-semibold","text-slate-700","hover:bg-slate-50"],[1,"fa-solid","fa-arrow-left"],[1,"max-w-7xl","mx-auto","px-4","pt-8","space-y-8"],["class","rounded-2xl border border-rose-200 bg-white p-4 shadow-sm animate-fade-in",4,"ngIf"],[1,"rounded-2xl","border","border-slate-200","bg-white","p-6","shadow-sm"],[1,"flex","items-center","justify-between","mb-4"],[1,"p-2","rounded-xl","bg-sky-100","text-sky-600"],[1,"fa-solid","fa-circle-info","text-sm"],[1,"text-lg","font-bold","text-slate-900"],[1,"text-sm","text-slate-600"],[1,"inline-flex","items-center","gap-2","rounded-xl","border","border-slate-300","bg-white","px-4","py-2","text-xs","font-semibold","text-slate-700","hover:bg-slate-50","disabled:opacity-50",3,"click","disabled"],[1,"fa-solid","fa-rotate-right"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-4","items-end"],[1,"space-y-2"],[1,"block","text-sm","font-semibold","text-slate-700"],["type","number","placeholder","Autodetectar (si solo administras una)",1,"w-full","rounded-xl","border","border-slate-300","bg-white","px-4","py-3","text-sm",3,"ngModelChange","ngModel"],[1,"text-xs","text-slate-500"],["class","md:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4",4,"ngIf"],[1,"rounded-2xl","border","border-slate-200","bg-white","p-6","shadow-sm","space-y-6"],[1,"flex","items-center","gap-3","mb-2"],[1,"p-2","rounded-xl","bg-emerald-100","text-emerald-600"],[1,"fa-solid","fa-upload","text-sm"],[1,"grid","grid-cols-1","md:grid-cols-3","gap-6","items-start"],[1,"space-y-2","md:col-span-2"],[1,"flex","flex-col","gap-2","rounded-xl","border","border-dashed","border-slate-300","bg-slate-50","px-4","py-3"],["type","file","accept",".xlsx,.xls,.csv",1,"hidden",3,"change"],["type","button",1,"inline-flex","items-center","justify-center","gap-2","rounded-lg","border","border-slate-300","bg-white","px-4","py-2","text-xs","font-semibold","text-slate-700","hover:bg-slate-50",3,"click"],[1,"fa-solid","fa-folder-open","text-slate-500"],[1,"text-xs","text-slate-500","flex","items-center","gap-2"],[1,"fa-solid","fa-circle-info","text-[10px]"],["class","text-xs text-slate-600",4,"ngIf"],[1,"space-y-4"],[1,"inline-flex","items-center","gap-2","text-sm"],["type","checkbox",1,"rounded","border-slate-300","text-rose-600","focus:ring-rose-200",3,"ngModelChange","ngModel"],[1,"text-xs","text-rose-500"],["type","number","min","1","max","12",1,"w-full","rounded-xl","border","border-slate-300","bg-white","px-3","py-2","text-sm",3,"ngModelChange","ngModel"],[1,"flex","flex-wrap","gap-3","pt-2"],[1,"inline-flex","items-center","gap-3","rounded-xl","bg-emerald-600","px-6","py-3","text-sm","font-semibold","text-white","hover:bg-emerald-700","disabled:opacity-50","shadow-md","hover:shadow-lg",3,"click","disabled"],[1,"fa-solid","fa-cloud-arrow-up"],["class","fa-solid fa-circle-notch animate-spin",4,"ngIf"],[1,"inline-flex","items-center","gap-2","rounded-xl","border","border-slate-300","bg-white","px-5","py-3","text-sm","font-semibold","text-slate-700","hover:bg-slate-50",3,"click","disabled"],[1,"fa-solid","fa-file-excel"],[1,"inline-flex","items-center","gap-2","rounded-xl","border","border-slate-200","bg-white","px-4","py-2","text-xs","font-semibold","text-slate-600","hover:bg-slate-50",3,"click","disabled"],[1,"fa-solid","fa-eraser"],["class","rounded-2xl border border-slate-200 bg-white p-6 shadow-sm space-y-4",4,"ngIf"],["class","fixed inset-0 bg-white/70 backdrop-blur-sm z-50 grid place-items-center",4,"ngIf"],[1,"rounded-2xl","border","border-rose-200","bg-white","p-4","shadow-sm","animate-fade-in"],[1,"flex","items-start","gap-4"],[1,"flex-shrink-0","p-2","rounded-lg","bg-rose-100","text-rose-600"],[1,"fa-solid","fa-circle-exclamation","text-sm"],[1,"flex-1","min-w-0"],[1,"font-semibold","text-rose-900","mb-1"],[1,"text-sm","text-rose-700"],[1,"flex-shrink-0","text-slate-400","hover:text-slate-600","transition-colors",3,"click"],[1,"fa-solid","fa-xmark","text-sm"],[1,"md:col-span-2","grid","grid-cols-1","md:grid-cols-2","gap-4"],[1,"p-4","rounded-xl","border","border-slate-200","bg-slate-50","text-center"],[1,"text-xs","text-slate-500","mb-1"],[1,"text-lg","font-black","text-slate-900"],[1,"p-4","rounded-xl","border","border-emerald-200",3,"ngClass"],[1,"text-sm","font-semibold",3,"ngClass"],[4,"ngIf","ngIfElse"],[1,"text-xs","text-slate-600"],[1,"fa-solid","fa-circle-notch","animate-spin"],[1,"rounded-2xl","border","border-slate-200","bg-white","p-6","shadow-sm","space-y-4"],[1,"p-2","rounded-xl","bg-slate-100","text-slate-600"],[1,"fa-solid","fa-clipboard-check","text-sm"],["class","grid grid-cols-1 md:grid-cols-4 gap-4",4,"ngIf"],["class","mt-4",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-4","gap-4"],[1,"text-center","p-4","rounded-xl","bg-slate-50","border","border-slate-200"],[1,"text-2xl","font-black","text-slate-900"],[1,"text-xs","font-medium","text-slate-600","mt-1"],[1,"text-center","p-4","rounded-xl","bg-indigo-50","border","border-indigo-200"],[1,"text-2xl","font-black","text-indigo-700"],[1,"text-xs","font-medium","text-indigo-700","mt-1"],[1,"text-center","p-4","rounded-xl","bg-emerald-50","border","border-emerald-200"],[1,"text-2xl","font-black","text-emerald-700"],[1,"text-xs","font-medium","text-emerald-700","mt-1"],[1,"text-center","p-4","rounded-xl","bg-rose-50","border","border-rose-200"],[1,"text-2xl","font-black","text-rose-700"],[1,"text-xs","font-medium","text-rose-700","mt-1"],[1,"mt-4"],[1,"flex","items-center","justify-between","mb-2"],[1,"text-sm","font-semibold","text-rose-700","flex","items-center","gap-2"],[1,"fa-solid","fa-triangle-exclamation"],[1,"rounded-xl","border","border-rose-100","bg-rose-50/40","max-h-64","overflow-auto"],[1,"min-w-full","text-xs"],[1,"bg-rose-100/80","text-rose-900"],[1,"px-3","py-2","text-left","font-semibold"],["class","border-t border-rose-100",4,"ngFor","ngForOf","ngForTrackBy"],[1,"border-t","border-rose-100"],[1,"px-3","py-2","text-rose-900"],[1,"px-3","py-2","text-rose-900","font-mono"],[1,"text-[10px]","break-all"],[1,"fixed","inset-0","bg-white/70","backdrop-blur-sm","z-50","grid","place-items-center"],[1,"text-center"],[1,"relative"],[1,"w-16","h-16","rounded-full","border-4","border-slate-200"],[1,"absolute","inset-0","w-16","h-16","animate-spin","rounded-full","border-4","border-emerald-600","border-t-transparent"],[1,"mt-4","text-lg","font-semibold","text-slate-900"],[1,"text-sm","text-slate-600","mt-2"]],template:function(a,r){if(a&1){let p=I();t(0,"div",2)(1,"header",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7),d(6,"i",8),e(),t(7,"div")(8,"nav",9)(9,"a",10),i(10,"Inicio"),e(),d(11,"i",11),t(12,"a",12),i(13,"Reportes"),e(),d(14,"i",11),t(15,"span",13),i(16,"Importar horas hist\xF3ricas"),e()(),t(17,"h1",14),i(18,"Importar horas hist\xF3ricas"),e(),t(19,"p",15),i(20," Carga horas de per\xEDodos anteriores desde un archivo Excel. Nunca se escriben datos en el per\xEDodo en curso. "),e()()(),t(21,"div",16)(22,"a",17),d(23,"i",18),i(24," Volver al reporte "),e()()()()(),t(25,"main",19),b(26,X,11,1,"div",20),t(27,"section",21)(28,"div",22)(29,"div",6)(30,"div",23),d(31,"i",24),e(),t(32,"div")(33,"h2",25),i(34,"Estado actual"),e(),t(35,"p",26),i(36," Consulta si ya existen horas hist\xF3ricas registradas para tu EP-SEDE. "),e()()(),t(37,"button",27),g("click",function(){return x(p),u(r.cargarStatus())}),d(38,"i",28),i(39," Refrescar "),e()(),t(40,"div",29)(41,"div",30)(42,"label",31),i(43," EP-SEDE (opcional) "),e(),t(44,"input",32),g("ngModelChange",function(m){return x(p),u(r.epSedeId.set(m?+m:null))}),e(),t(45,"p",33),i(46," D\xE9jalo vac\xEDo si solo administras una EP-SEDE. Si administras varias, indica el ID. "),e()(),b(47,ee,13,5,"div",34),e()(),t(48,"section",35)(49,"div",36)(50,"div",37),d(51,"i",38),e(),t(52,"div")(53,"h2",25),i(54,"Importar archivo"),e(),t(55,"p",26),i(56," Usa la plantilla sugerida para asegurar el formato correcto de columnas y per\xEDodos. "),e()()(),t(57,"div",39)(58,"div",40)(59,"label",31),i(60,"Archivo Excel"),e(),t(61,"div",41)(62,"input",42,0),g("change",function(m){return x(p),u(r.onFileChange(m))}),e(),t(64,"button",43),g("click",function(){x(p);let m=y(63);return u(m.click())}),d(65,"i",44),t(66,"span"),i(67,"Seleccionar archivo\u2026"),e()(),t(68,"div",45),d(69,"i",46),i(70," Extensiones permitidas: .xlsx, .xls, .csv "),e(),b(71,te,4,1,"div",47),e()(),t(72,"div",48)(73,"div",30)(74,"label",31),i(75," Reemplazar datos previos "),e(),t(76,"label",49)(77,"input",50),g("ngModelChange",function(m){return x(p),u(r.replace.set(!!m))}),e(),t(78,"span"),i(79,"Limpiar y volver a generar las horas tocadas por este archivo."),e()(),t(80,"p",51),i(81," \xDAsalo con cuidado: borra asistencias/horas previas con meta "),t(82,"b"),i(83,"horas_import"),e(),i(84," en las sesiones/proyectos afectados. "),e()(),t(85,"div",30)(86,"label",31),i(87," Per\xEDodos en plantilla "),e(),t(88,"input",52),g("ngModelChange",function(m){return x(p),u(r.ultimos.set(m?+m:6))}),e(),t(89,"p",33),i(90," Cantidad usada al generar la plantilla (si no indicas "),t(91,"code"),i(92,"periodos[]"),e(),i(93," expl\xEDcitos). "),e()()()(),t(94,"div",53)(95,"button",54),g("click",function(){return x(p),u(r.importar())}),d(96,"i",55),b(97,ie,1,0,"i",56),i(98),e(),t(99,"button",57),g("click",function(){return x(p),u(r.descargarPlantilla())}),d(100,"i",58),i(101," Descargar plantilla "),e(),t(102,"button",59),g("click",function(){return x(p),u(r.limpiarResultado())}),d(103,"i",60),i(104," Limpiar resultado "),e()()(),b(105,oe,11,2,"section",61)(106,le,9,0,"div",62),e()()}a&2&&(n(26),s("ngIf",r.error()),n(11),s("disabled",r.loading()),n(),H("animate-spin",r.loading()),n(6),s("ngModel",r.epSedeId()),n(3),s("ngIf",r.hasStatus()),n(24),s("ngIf",r.file()),n(6),s("ngModel",r.replace()),n(11),s("ngModel",r.ultimos()),n(7),s("disabled",r.loading()||!r.file()),n(),H("hidden",r.loading()),n(),s("ngIf",r.loading()),n(),v(" ",r.loading()?"Importando...":"Importar"," "),n(),s("disabled",r.loading()),n(3),s("disabled",r.loading()),n(3),s("ngIf",r.hasResultado()),n(),s("ngIf",r.loading()))},dependencies:[L,T,F,N,G,z,K,U,B,q,Y,J,O,j,A],encapsulation:2});var W=E;export{W as RpImportHistoricoHorasPage};
