import{a as K}from"./chunk-OKPZKVFZ.js";import{a as oe}from"./chunk-G33XJ7AN.js";import{A as ae,b as J,d as Q,e as W,g as X,i as Y,j as Z,k as ee,r as te,s as ne,t as ie,v as re}from"./chunk-J2XPQYKK.js";import"./chunk-LWNR2F3M.js";import{d as B,f as G,g as U}from"./chunk-5VQTM22E.js";import{i as j,j as H,k as q,u as z}from"./chunk-FE5WSVYG.js";import{$ as E,$a as t,Fb as O,Gb as R,Jb as $,Ka as D,Ob as M,Pa as g,T as h,Tb as I,Y as C,Z as F,_ as b,_a as d,ab as n,bb as f,eb as y,fa as p,fb as S,gb as A,kb as x,mb as m,rb as w,vb as i,wb as v,xb as c,ya as o,yb as k,zb as V}from"./chunk-63T4HJ2B.js";import{a as N,b as L}from"./chunk-IMPBB4AK.js";var me=()=>["new"],ce=(l,r,e,a)=>({"bg-sky-50 text-sky-700":l,"bg-emerald-50 text-emerald-700":r,"bg-slate-50 text-slate-700":e,"bg-red-50 text-red-700":a}),pe=l=>[l];function ge(l,r){if(l&1&&(t(0,"div",38),b(),t(1,"svg",39),f(2,"path",40),n(),E(),t(3,"span"),i(4),n()()),l&2){let e=m();o(4),v(e.errorMsg())}}function ue(l,r){if(l&1&&(t(0,"div",41),i(1," Mostrando "),t(2,"span",42),i(3),n(),i(4," \u2013 "),t(5,"span",42),i(6),n(),i(7," de "),t(8,"span",42),i(9),n()()),l&2){let e=m();o(3),v(e.fromItem()),o(3),v(e.toItem()),o(3),v(e.total())}}function xe(l,r){l&1&&(t(0,"div",43),f(1,"div",44),i(2," Cargando eventos... "),n())}function ve(l,r){if(l&1&&(t(0,"div",59),i(1),n()),l&2){let e=m().$implicit;o(),c(" ",e.subtitulo," ")}}function fe(l,r){if(l&1&&(t(0,"span"),i(1),n()),l&2){let e=m(2).$implicit;o(),c("(",e.periodo==null?null:e.periodo.estado,")")}}function _e(l,r){if(l&1&&(y(0),i(1),g(2,fe,2,1,"span",37),S()),l&2){let e=m().$implicit;o(),k(" ",e.periodo==null?null:e.periodo.anio," - ",e.periodo==null?null:e.periodo.ciclo," "),o(),d("ngIf",e.periodo==null?null:e.periodo.estado)}}function he(l,r){if(l&1&&i(0),l&2){let e=m().$implicit;c(" ID: ",e.periodo_id," ")}}function be(l,r){if(l&1&&(t(0,"tr",53)(1,"td",54),i(2),n(),t(3,"td",55)(4,"div",56),i(5),n(),g(6,ve,2,1,"div",57),n(),t(7,"td",58),g(8,_e,3,3,"ng-container",45)(9,he,1,1,"ng-template",null,1,M),n(),t(11,"td",58)(12,"div"),i(13),n(),t(14,"div",59),i(15),n()(),t(16,"td",58)(17,"span",42),i(18),n(),t(19,"span",60),i(20),n()(),t(21,"td",49)(22,"span",61),i(23),n()(),t(24,"td",62)(25,"a",63),i(26," Ver detalle "),n()()()),l&2){let e=r.$implicit,a=w(10),s=m(3);o(2),c(" ",e.codigo," "),o(3),c(" ",e.titulo," "),o(),d("ngIf",e.subtitulo),o(2),d("ngIf",e.periodo)("ngIfElse",a),o(5),c(" ",s.sesionesResumen(e)," "),o(2),k(" ",(e.sesiones==null?null:e.sesiones.length)||0," sesi\xF3n",((e.sesiones==null?null:e.sesiones.length)||0)===1?"":"es"," "),o(3),c(" ",s.prettyTargetType(e.targetable_type)," "),o(2),c(" #",e.targetable_id," "),o(2),d("ngClass",$(13,ce,e.estado==="PLANIFICADO",e.estado==="EN_CURSO",e.estado==="CERRADO",e.estado==="CANCELADO")),o(),c(" ",s.prettyEstado(e.estado)," "),o(2),d("routerLink",R(18,pe,e.id))}}function Ee(l,r){if(l&1){let e=A();y(0),t(1,"div",46)(2,"table",47)(3,"thead",48)(4,"tr")(5,"th",49),i(6,"C\xF3digo"),n(),t(7,"th",49),i(8,"T\xEDtulo"),n(),t(9,"th",49),i(10,"Per\xEDodo"),n(),t(11,"th",49),i(12,"Sesiones"),n(),t(13,"th",49),i(14,"Target"),n(),t(15,"th",49),i(16,"Estado"),n(),t(17,"th",49),i(18,"Acciones"),n()()(),t(19,"tbody"),g(20,be,27,20,"tr",50),n()()(),t(21,"div",51)(22,"div"),i(23," P\xE1gina "),t(24,"span",42),i(25),n(),i(26," de "),t(27,"span",42),i(28),n()(),t(29,"div",12)(30,"button",52),x("click",function(){C(e);let s=m(2);return F(s.goToPage(s.page()-1))}),i(31," Anterior "),n(),t(32,"button",52),x("click",function(){C(e);let s=m(2);return F(s.goToPage(s.page()+1))}),i(33," Siguiente "),n()()(),S()}if(l&2){let e=m(2);o(20),d("ngForOf",e.eventos())("ngForTrackBy",e.trackEvento),o(5),v(e.page()),o(3),v(e.totalPages()),o(2),d("disabled",e.page()<=1),o(2),d("disabled",e.page()>=e.totalPages())}}function ye(l,r){l&1&&(t(0,"div",64),i(1," No se encontraron eventos con los filtros actuales. "),n())}function Se(l,r){if(l&1&&(y(0),g(1,Ee,34,6,"ng-container",45)(2,ye,2,0,"ng-template",null,0,M),S()),l&2){let e=w(3),a=m();o(),d("ngIf",a.eventos().length>0)("ngIfElse",e)}}var _=class _{constructor(){this.api=h(oe);this.route=h(B);this.router=h(G);this.loader=h(K);this.loading=p(!1);this.errorMsg=p(null);this.eventos=p([]);this.total=p(0);this.pageSize=15;this.page=p(1);this.estadoFilter=p("");this.targetIdFilter=p(null);this.searchFilter=p("");this.totalPages=I(()=>this.total()>0?Math.max(1,Math.ceil(this.total()/this.pageSize)):1);this.fromItem=I(()=>this.total()===0?0:(this.page()-1)*this.pageSize+1);this.toItem=I(()=>this.total()===0?0:Math.min(this.total(),this.page()*this.pageSize));this.trackEvento=(r,e)=>e.id}ngOnInit(){this.route.queryParamMap.subscribe(r=>{let e=r.get("page"),a=e?Number(e):1;this.page.set(Number.isFinite(a)&&a>0?a:1),this.estadoFilter.set(r.get("estado")??"");let s=r.get("target_id");this.targetIdFilter.set(s&&Number(s)>0?Number(s):null),this.searchFilter.set(r.get("search")??""),this.loadEventos()})}async loadEventos(){this.loading.set(!0),this.errorMsg.set(null);let r={page:this.page()};this.estadoFilter()&&(r.estado=this.estadoFilter()),this.targetIdFilter()&&(r.target_id=this.targetIdFilter()),this.searchFilter().trim()&&(r.search=this.searchFilter().trim()),this.loader.track(this.api.listarEventos(r),"Cargando eventos...").subscribe({next:e=>{let a=e.data;this.eventos.set(a.items??[]),this.total.set(a.total??a.items?.length??0)},error:e=>{console.error(e),this.eventos.set([]),this.total.set(0),this.errorMsg.set(e?.error?.message||"No se pudieron cargar los eventos."),this.loading.set(!1)},complete:()=>{this.loading.set(!1)}})}onTargetIdChange(r){let e=Number(r);this.targetIdFilter.set(Number.isFinite(e)&&e>0?e:null)}aplicarFiltros(){let r={page:1};this.estadoFilter()&&(r.estado=this.estadoFilter()),this.targetIdFilter()&&(r.target_id=this.targetIdFilter()),this.searchFilter().trim()&&(r.search=this.searchFilter().trim()),this.router.navigate([],{relativeTo:this.route,queryParams:r,queryParamsHandling:"merge"})}limpiarFiltros(){this.estadoFilter.set(""),this.targetIdFilter.set(null),this.searchFilter.set(""),this.router.navigate([],{relativeTo:this.route,queryParams:{page:1,estado:null,target_id:null,search:null},queryParamsHandling:"merge"})}goToPage(r){if(r<1||r===this.page()||r>this.totalPages())return;let e=L(N({},this.route.snapshot.queryParams),{page:r});this.router.navigate([],{relativeTo:this.route,queryParams:e,queryParamsHandling:"merge"})}prettyEstado(r){switch(r){case"PLANIFICADO":return"Planificado";case"EN_CURSO":return"En curso";case"CERRADO":return"Cerrado";case"CANCELADO":return"Cancelado";default:return r}}prettyTargetType(r){switch(r){case"ep_sede":return"EP-Sede";case"sede":return"Sede";case"facultad":return"Facultad";default:return r}}sesionesResumen(r){let e=r.sesiones??[];if(!e.length)return"Sin sesiones";let a=[...e].sort((P,T)=>{let se=`${P.fecha} ${P.hora_inicio}`,de=`${T.fecha} ${T.hora_inicio}`;return se.localeCompare(de)}),s=a[0],u=a[a.length-1];return a.length===1?`${s.fecha} \xB7 ${s.hora_inicio}\u2013${s.hora_fin}`:`${a.length} sesiones \xB7 ${s.fecha} ${s.hora_inicio} \u2192 ${u.fecha} ${u.hora_fin}`}};_.\u0275fac=function(e){return new(e||_)},_.\u0275cmp=D({type:_,selectors:[["app-events-list-page"]],decls:61,vars:12,consts:[["emptyEventosTpl",""],["periodoIdTpl",""],[1,"min-h-screen","bg-gradient-to-br","from-slate-50","via-sky-50/40","to-slate-50"],[1,"mx-auto","max-w-6xl","px-4","py-8"],[1,"mb-6","flex","flex-col","gap-4","sm:flex-row","sm:items-center","sm:justify-between"],[1,"flex","items-start","gap-3"],[1,"mt-1","flex","h-11","w-11","items-center","justify-center","rounded-2xl","bg-sky-600","text-white","shadow-lg","shadow-sky-500/30"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-6","w-6"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"],[1,"text-[11px]","font-semibold","uppercase","tracking-wide","text-sky-700"],[1,"mt-0.5","text-2xl","sm:text-3xl","font-bold","tracking-tight","text-slate-900"],[1,"mt-1","text-sm","text-slate-600","max-w-xl"],[1,"flex","gap-2"],["type","button",1,"inline-flex","items-center","gap-2","rounded-lg","bg-sky-600","px-4","py-2","text-sm","font-medium","text-white","shadow-sm","hover:bg-sky-700","hover:shadow-md",3,"routerLink"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-4","w-4"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"mb-6","rounded-2xl","border","border-white/70","bg-white/90","p-4","shadow-sm","backdrop-blur-sm"],[1,"grid","grid-cols-1","gap-3","sm:grid-cols-4","sm:items-end",3,"ngSubmit"],[1,"mb-1","block","text-xs","font-medium","text-slate-600"],["name","estado",1,"w-full","rounded-lg","border","border-slate-200","px-3","py-2","text-sm","shadow-sm","focus:border-sky-500","focus:outline-none","focus:ring-2","focus:ring-sky-500/30",3,"ngModelChange","ngModel"],["value",""],["value","PLANIFICADO"],["value","EN_CURSO"],["value","CERRADO"],["value","CANCELADO"],["type","number","min","1","name","target_id","placeholder","Ej. 12",1,"w-full","rounded-lg","border","border-slate-200","px-3","py-2","text-sm","shadow-sm","focus:border-sky-500","focus:outline-none","focus:ring-2","focus:ring-sky-500/30",3,"ngModelChange","ngModel"],["type","text","name","search","placeholder","Ej. Semana de inducci\xF3n",1,"w-full","rounded-lg","border","border-slate-200","px-3","py-2","text-sm","shadow-sm","focus:border-sky-500","focus:outline-none","focus:ring-2","focus:ring-sky-500/30",3,"ngModelChange","ngModel"],["type","submit",1,"inline-flex","flex-1","items-center","justify-center","gap-2","rounded-lg","bg-slate-900","px-3","py-2","text-sm","font-medium","text-white","shadow-sm","hover:bg-black","hover:shadow-md"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 6a6 6 0 014.472 9.949l3.39 3.39a1 1 0 01-1.415 1.414l-3.39-3.39A6 6 0 1110 6z"],["type","button",1,"inline-flex","flex-1","items-center","justify-center","rounded-lg","border","border-slate-200","bg-white","px-3","py-2","text-sm","font-medium","text-slate-700","hover:bg-slate-50",3,"click"],["class","mb-4 flex gap-2 rounded-xl border border-red-200 bg-red-50/90 px-4 py-3 text-sm text-red-800",4,"ngIf"],[1,"rounded-2xl","border","border-white/70","bg-white/90","p-4","shadow-sm","backdrop-blur-sm"],[1,"mb-3","flex","items-center","justify-between","gap-3"],[1,"text-[11px]","uppercase","tracking-wide","text-slate-500"],[1,"text-lg","font-semibold","text-slate-900"],["class","text-[11px] text-slate-500",4,"ngIf"],["class","flex flex-col items-center justify-center py-10 text-sm text-slate-500",4,"ngIf"],[4,"ngIf"],[1,"mb-4","flex","gap-2","rounded-xl","border","border-red-200","bg-red-50/90","px-4","py-3","text-sm","text-red-800"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"h-4","w-4","flex-shrink-0"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"text-[11px]","text-slate-500"],[1,"font-medium"],[1,"flex","flex-col","items-center","justify-center","py-10","text-sm","text-slate-500"],[1,"mb-3","h-6","w-6","animate-spin","rounded-full","border-2","border-sky-600","border-t-transparent"],[4,"ngIf","ngIfElse"],[1,"overflow-x-auto"],[1,"min-w-full","text-left","text-xs","text-slate-700"],[1,"border-b","border-slate-100","text-[11px]","uppercase","text-slate-500"],[1,"py-2","pr-4"],["class","border-b border-slate-50 text-[11px] hover:bg-sky-50/40",4,"ngFor","ngForOf","ngForTrackBy"],[1,"mt-4","flex","flex-col","items-center","justify-between","gap-3","text-[11px]","text-slate-600","sm:flex-row"],["type","button",1,"inline-flex","items-center","rounded-lg","border","border-slate-200","bg-white","px-3","py-1.5","font-medium","hover:bg-slate-50","disabled:cursor-not-allowed","disabled:opacity-50",3,"click","disabled"],[1,"border-b","border-slate-50","text-[11px]","hover:bg-sky-50/40"],[1,"py-2","pr-4","font-mono","text-[11px]","text-slate-700"],[1,"py-2","pr-4","text-slate-800"],[1,"font-semibold","text-slate-900"],["class","text-[11px] text-slate-500 mt-0.5",4,"ngIf"],[1,"py-2","pr-4","text-slate-700"],[1,"text-[11px]","text-slate-500","mt-0.5"],[1,"ml-1","text-slate-500"],[1,"inline-flex","rounded-full","px-2","py-0.5","font-medium",3,"ngClass"],[1,"py-2","pr-4","text-right"],[1,"inline-flex","items-center","gap-1","rounded-lg","border","border-slate-200","bg-white","px-2.5","py-1","text-[11px]","font-medium","text-slate-700","hover:bg-slate-50",3,"routerLink"],[1,"py-10","text-center","text-sm","text-slate-500"]],template:function(e,a){e&1&&(t(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6),b(),t(5,"svg",7),f(6,"path",8),n()(),E(),t(7,"div")(8,"p",9),i(9," M\xF3dulo de eventos "),n(),t(10,"h1",10),i(11," Eventos acad\xE9micos "),n(),t(12,"p",11),i(13," Administra y consulta los eventos planificados por periodo, \xE1mbito y sus sesiones. "),n()()(),t(14,"div",12)(15,"button",13),b(),t(16,"svg",14),f(17,"path",15),n(),i(18," Nuevo evento "),n()()(),E(),t(19,"section",16)(20,"form",17),x("ngSubmit",function(){return a.aplicarFiltros()}),t(21,"div")(22,"label",18),i(23," Estado "),n(),t(24,"select",19),x("ngModelChange",function(u){return a.estadoFilter.set(u)}),t(25,"option",20),i(26,"Todos"),n(),t(27,"option",21),i(28,"Planificado"),n(),t(29,"option",22),i(30,"En curso"),n(),t(31,"option",23),i(32,"Cerrado"),n(),t(33,"option",24),i(34,"Cancelado"),n()()(),t(35,"div")(36,"label",18),i(37," Target ID (Sede / Facultad / EP-Sede) "),n(),t(38,"input",25),x("ngModelChange",function(u){return a.onTargetIdChange(u)}),n()(),t(39,"div")(40,"label",18),i(41," Buscar por t\xEDtulo / c\xF3digo "),n(),t(42,"input",26),x("ngModelChange",function(u){return a.searchFilter.set(u)}),n()(),t(43,"div",12)(44,"button",27),b(),t(45,"svg",14),f(46,"path",28),n(),i(47," Aplicar "),n(),E(),t(48,"button",29),x("click",function(){return a.limpiarFiltros()}),i(49," Limpiar "),n()()()(),g(50,ge,5,1,"div",30),t(51,"section",31)(52,"div",32)(53,"div")(54,"div",33),i(55," Listado de eventos "),n(),t(56,"h2",34),i(57),n()(),g(58,ue,10,3,"div",35),n(),g(59,xe,3,0,"div",36)(60,Se,4,2,"ng-container",37),n()()()),e&2&&(o(15),d("routerLink",O(11,me)),o(9),d("ngModel",a.estadoFilter()),o(14),d("ngModel",a.targetIdFilter()),o(4),d("ngModel",a.searchFilter()),o(8),d("ngIf",a.errorMsg()),o(7),V(" ",a.total()," evento",a.total()===1?"":"s"," encontrado",a.total()===1?"":"s"," "),o(),d("ngIf",a.total()>0),o(),d("ngIf",a.loading()),o(),d("ngIf",!a.loading()))},dependencies:[z,j,H,q,ae,Z,ne,ie,J,ee,te,Q,W,re,Y,X,U],encapsulation:2});var le=_;export{le as EventsListPage};
