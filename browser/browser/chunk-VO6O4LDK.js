import{a as H}from"./chunk-PQMDU5SM.js";import{a as z}from"./chunk-IZ77CWTJ.js";import{A as U,b as O,d as $,i as j,r as B,s as q,t as G}from"./chunk-J2XPQYKK.js";import"./chunk-LWNR2F3M.js";import{d as L,g as N,h as R,j as V}from"./chunk-5VQTM22E.js";import{j as A,k as D,u as T}from"./chunk-FE5WSVYG.js";import{$a as e,Fb as F,Ka as w,Pa as g,T as _,Y as S,Z as y,_a as u,ab as t,bb as r,fa as p,gb as C,kb as c,mb as x,tb as P,vb as i,wb as v,xb as M,ya as o,yb as I}from"./chunk-63T4HJ2B.js";import{a as E}from"./chunk-IMPBB4AK.js";var K=()=>({exact:!0});function Q(m,d){m&1&&(e(0,"span",76),i(1," \u2022 En curso "),t())}function W(m,d){if(m&1&&(e(0,"option",38),i(1),g(2,Q,2,0,"span",75),t()),m&2){let a=d.$implicit;u("ngValue",a.id),o(),I(" ",a.anio,"-",a.ciclo," "),o(),u("ngIf",(a.estado||"")==="EN_CURSO")}}function X(m,d){if(m&1&&(e(0,"div",77)(1,"div",78)(2,"div",4)(3,"div",79),r(4,"i",80),t(),e(5,"div")(6,"div",81),i(7),t(),e(8,"div",82)(9,"span",83),i(10,"C\xF3digo:"),t(),i(11),e(12,"span",83),i(13,"Documento:"),t(),i(14),t()()(),e(15,"div",84),i(16," Estudiante encontrado "),t()()()),m&2){let a,n,l,s=x();o(7),v(((a=s.alumnoCard())==null?null:a.nombre)||"\u2014"),o(4),M(" ",((n=s.alumnoCard())==null?null:n.codigo)||"\u2014"," \u2022 "),o(3),M(" ",((l=s.alumnoCard())==null?null:l.doc)||"\u2014"," ")}}function Y(m,d){if(m&1){let a=C();e(0,"div",85)(1,"div",4),r(2,"i",86),e(3,"div",87)(4,"div",88),i(5,"Operaci\xF3n Exitosa"),t(),e(6,"div",89),i(7),t()(),e(8,"button",90),c("click",function(){S(a);let l=x();return y(l.okMsg.set(null))}),r(9,"i",91),t()()()}if(m&2){let a=x();o(7),v(a.okMsg())}}function Z(m,d){if(m&1){let a=C();e(0,"div",92)(1,"div",4),r(2,"i",93),e(3,"div",87)(4,"div",88),i(5,"Error en la Operaci\xF3n"),t(),e(6,"div",89),i(7),t()(),e(8,"button",94),c("click",function(){S(a);let l=x();return y(l.error.set(null))}),r(9,"i",91),t()()()}if(m&2){let a=x();o(7),v(a.error())}}function ee(m,d){m&1&&r(0,"i",95)}var f=class f{constructor(){this.api=_(H);this.lookups=_(z);this.route=_(L);this.periodos=p([]);this.form=p({codigo_estudiante:null,expediente_id:null,periodo_id:0,ciclo:null,grupo:null,modalidad_estudio:null,modo_contrato:null,fecha_matricula:null});this.loading=p(!1);this.error=p(null);this.okMsg=p(null);this.alumnoCard=p(null);let d=this.route.snapshot.queryParamMap,a=d.get("expedienteId"),n=d.get("codigo");a&&this.patch({expediente_id:+a}),n&&(this.patch({codigo_estudiante:n}),queueMicrotask(()=>this.cargarPorCodigo())),this.lookups.fetchPeriodos("",!1,50).subscribe({next:l=>{let s=[...l].sort((h,k)=>`${k.anio}-${k.ciclo}`.localeCompare(`${h.anio}-${h.ciclo}`));this.periodos.set(s);let b=s.find(h=>(h.estado||"").toUpperCase()==="EN_CURSO");b&&this.patch({periodo_id:b.id})},error:()=>this.periodos.set([])})}patch(d){this.form.update(a=>E(E({},a),d))}cargarPorCodigo(){let d=(this.form().codigo_estudiante||"").trim();d&&(this.loading.set(!0),this.error.set(null),this.okMsg.set(null),this.api.buscar({codigo:d}).subscribe({next:a=>{if(!a.ok){this.error.set(a.message||"No se encontr\xF3 el expediente."),this.alumnoCard.set(null);return}let n=a.data.user||{},l=a.data.expediente||{},b=(Array.isArray(a.data.matriculas)?a.data.matriculas:[])[0]||null;this.patch({expediente_id:l.id??null,ciclo:l.ciclo??null,grupo:l.grupo??null,modalidad_estudio:b?.modalidad_estudio??null,modo_contrato:b?.modo_contrato??null}),this.alumnoCard.set({nombre:`${n.first_name||""} ${n.last_name||""}`.trim(),codigo:l.codigo_estudiante||d,doc:n.doc_numero||"\u2014"}),this.okMsg.set("Expediente encontrado. Campos precargados.")},error:a=>this.error.set(a?.error?.message||"Error de red."),complete:()=>this.loading.set(!1)}))}enviar(){if(!this.form().periodo_id){this.error.set("Selecciona un per\xEDodo.");return}this.loading.set(!0),this.error.set(null),this.okMsg.set(null),this.api.matricular(this.form()).subscribe({next:d=>{d.ok?this.okMsg.set(d.message||"Operaci\xF3n realizada."):this.error.set(d.message||"No se pudo procesar.")},error:d=>this.error.set(d?.error?.message||"Error de red."),complete:()=>this.loading.set(!1)})}anular(){this.patch({fecha_matricula:null}),this.enviar()}limpiarFormulario(){let d=this.form().periodo_id||0;this.form.set({codigo_estudiante:null,expediente_id:null,periodo_id:d,ciclo:null,grupo:null,modalidad_estudio:null,modo_contrato:null,fecha_matricula:null}),this.alumnoCard.set(null),this.okMsg.set(null),this.error.set(null)}};f.\u0275fac=function(a){return new(a||f)},f.\u0275cmp=w({type:f,selectors:[["m-manual-matricular-page"]],decls:167,vars:20,consts:[[1,"min-h-screen","bg-gradient-to-br","from-slate-50","to-blue-50/30","pb-16"],[1,"border-b","border-slate-200","bg-white/90","backdrop-blur-sm","sticky","top-0","z-20","shadow-sm"],[1,"max-w-6xl","mx-auto","px-4","py-4"],[1,"flex","items-center","justify-between","gap-4"],[1,"flex","items-center","gap-3"],[1,"p-2","rounded-xl","bg-gradient-to-br","from-blue-500","to-blue-600","text-white","shadow-md"],[1,"fa-solid","fa-graduation-cap","text-lg"],[1,"text-xs","text-slate-500","mb-1","flex","items-center","gap-1"],["routerLink","/",1,"hover:text-slate-700","font-medium","transition-colors","duration-200"],[1,"fa-solid","fa-chevron-right","text-[10px]","text-slate-400"],["routerLink","/m",1,"hover:text-slate-700","font-medium","transition-colors","duration-200"],[1,"text-blue-600","font-semibold"],[1,"text-2xl","font-bold","text-slate-900","tracking-tight"],[1,"text-sm","text-slate-600","mt-1"],["routerLink","/m/manual/buscar",1,"inline-flex","items-center","gap-2","rounded-xl","border","border-slate-300","bg-white","px-4","py-2","text-sm","font-semibold","text-slate-700","hover:bg-slate-50","hover:border-slate-400","transition-all","duration-200","shadow-sm"],[1,"fa-solid","fa-arrow-left","text-xs"],[1,"mt-6","flex","flex-wrap","gap-2"],["routerLink","/m/import","routerLinkActive","bg-blue-600 text-white shadow-md",1,"inline-flex","items-center","gap-2","rounded-xl","px-4","py-2.5","text-sm","font-semibold","border","border-blue-200","text-blue-700","hover:bg-blue-50","transition-all","duration-200","hover:shadow-sm",3,"routerLinkActiveOptions"],[1,"fa-solid","fa-file-import"],["routerLink","/m/manual/buscar","routerLinkActive","bg-blue-600 text-white shadow-md",1,"inline-flex","items-center","gap-2","rounded-xl","px-4","py-2.5","text-sm","font-semibold","border","border-blue-200","text-blue-700","hover:bg-blue-50","transition-all","duration-200","hover:shadow-sm"],[1,"fa-solid","fa-magnifying-glass"],["routerLink","/m/manual/registrar","routerLinkActive","bg-blue-600 text-white shadow-md",1,"inline-flex","items-center","gap-2","rounded-xl","px-4","py-2.5","text-sm","font-semibold","border","border-blue-200","text-blue-700","hover:bg-blue-50","transition-all","duration-200","hover:shadow-sm"],[1,"fa-solid","fa-user-pen"],["routerLink","/m/manual/matricular","routerLinkActive","bg-blue-600 text-white shadow-md",1,"inline-flex","items-center","gap-2","rounded-xl","px-4","py-2.5","text-sm","font-semibold","border","border-blue-200","text-blue-700","hover:bg-blue-50","transition-all","duration-200","hover:shadow-sm"],[1,"fa-solid","fa-graduation-cap"],[1,"max-w-4xl","mx-auto","px-4","pt-8","space-y-8"],[1,"rounded-2xl","border","border-slate-200","bg-white","p-6","shadow-sm"],[1,"flex","items-center","gap-3","mb-6","pb-4","border-b","border-slate-100"],[1,"p-2","rounded-xl","bg-blue-100","text-blue-600"],[1,"fa-solid","fa-user-graduate","text-lg"],[1,"text-xl","font-bold","text-slate-900"],[1,"text-sm","text-slate-600"],[1,"space-y-6"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-6"],[1,"space-y-3"],[1,"block","text-sm","font-semibold","text-slate-700"],[1,"text-rose-500","ml-1"],[1,"w-full","rounded-xl","border","border-slate-300","bg-white","px-4","py-3","text-sm","transition-all","duration-200","focus:border-blue-500","focus:ring-2","focus:ring-blue-200","shadow-sm",3,"ngModelChange","ngModel"],[3,"ngValue"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"text-xs","text-slate-500","flex","items-center","gap-1"],[1,"fa-solid","fa-info-circle","text-blue-500"],[1,"relative"],["placeholder","Ingresa el c\xF3digo del estudiante",1,"w-full","rounded-xl","border","border-slate-300","bg-white","px-4","py-3","pr-10","text-sm","transition-all","duration-200","focus:border-blue-500","focus:ring-2","focus:ring-blue-200","shadow-sm",3,"ngModelChange","keyup.enter","blur","ngModel"],[1,"absolute","right-3","top-1/2","transform","-translate-y-1/2","text-slate-400","hover:text-blue-600","transition-colors","duration-200",3,"click"],[1,"fa-solid","fa-lightbulb","text-amber-500"],["class","rounded-xl border border-blue-200 bg-gradient-to-r from-blue-50 to-blue-100/50 p-4 animate-fade-in",4,"ngIf"],[1,"space-y-4"],[1,"space-y-2"],["placeholder","Ej: 2024-1",1,"w-full","rounded-xl","border","border-slate-300","bg-white","px-4","py-3","text-sm","transition-all","duration-200","focus:border-blue-500","focus:ring-2","focus:ring-blue-200","shadow-sm",3,"ngModelChange","ngModel"],["value",""],["type","date",1,"w-full","rounded-xl","border","border-slate-300","bg-white","px-4","py-3","text-sm","transition-all","duration-200","focus:border-blue-500","focus:ring-2","focus:ring-blue-200","shadow-sm",3,"ngModelChange","ngModel"],["placeholder","Ej: A, B, C...",1,"w-full","rounded-xl","border","border-slate-300","bg-white","px-4","py-3","text-sm","transition-all","duration-200","focus:border-blue-500","focus:ring-2","focus:ring-blue-200","shadow-sm",3,"ngModelChange","ngModel"],["class","rounded-xl border border-emerald-200 bg-emerald-50 p-4 text-emerald-800 animate-fade-in",4,"ngIf"],["class","rounded-xl border border-rose-200 bg-rose-50 p-4 text-rose-800 animate-fade-in",4,"ngIf"],[1,"flex","flex-wrap","gap-4","pt-4","border-t","border-slate-100"],[1,"inline-flex","items-center","gap-3","rounded-xl","bg-gradient-to-r","from-blue-600","to-blue-700","px-6","py-3.5","text-sm","font-semibold","text-white","hover:from-blue-700","hover:to-blue-800","disabled:opacity-50","disabled:cursor-not-allowed","transition-all","duration-200","shadow-lg","hover:shadow-xl","disabled:shadow-md",3,"click","disabled"],[1,"fa-solid","fa-check"],["class","fa-solid fa-circle-notch animate-spin",4,"ngIf"],[1,"inline-flex","items-center","gap-2","rounded-xl","border","border-rose-300","bg-white","px-5","py-3.5","text-sm","font-semibold","text-rose-700","hover:bg-rose-50","hover:border-rose-400","disabled:opacity-50","transition-all","duration-200","shadow-sm",3,"click","disabled"],[1,"fa-solid","fa-ban"],[1,"inline-flex","items-center","gap-2","rounded-xl","border","border-slate-300","bg-white","px-5","py-3.5","text-sm","font-semibold","text-slate-700","hover:bg-slate-50","hover:border-slate-400","transition-all","duration-200","shadow-sm","ml-auto",3,"click"],[1,"fa-solid","fa-broom"],[1,"flex","items-center","gap-3","mb-4"],[1,"p-2","rounded-xl","bg-purple-100","text-purple-600"],[1,"fa-solid","fa-circle-info","text-sm"],[1,"text-lg","font-bold","text-slate-900"],[1,"grid","grid-cols-1","md:grid-cols-2","gap-4","text-sm","text-slate-600"],[1,"flex","items-start","gap-3"],[1,"fa-solid","fa-calendar-check","text-blue-500","mt-0.5"],[1,"font-semibold","text-slate-800"],[1,"text-xs","mt-1"],[1,"fa-solid","fa-id-card","text-green-500","mt-0.5"],[1,"fa-solid","fa-triangle-exclamation","text-amber-500","mt-0.5"],[1,"fa-solid","fa-rotate","text-slate-500","mt-0.5"],["class","text-green-600 font-semibold",4,"ngIf"],[1,"text-green-600","font-semibold"],[1,"rounded-xl","border","border-blue-200","bg-gradient-to-r","from-blue-50","to-blue-100/50","p-4","animate-fade-in"],[1,"flex","items-center","justify-between"],[1,"p-2","rounded-lg","bg-white","text-blue-600","shadow-sm"],[1,"fa-solid","fa-user","text-sm"],[1,"font-semibold","text-blue-900","text-lg"],[1,"text-sm","text-blue-700","mt-1"],[1,"font-medium"],[1,"text-xs","px-3","py-1","rounded-full","bg-blue-200","text-blue-800","font-medium"],[1,"rounded-xl","border","border-emerald-200","bg-emerald-50","p-4","text-emerald-800","animate-fade-in"],[1,"fa-solid","fa-circle-check","text-emerald-600","text-lg"],[1,"flex-1"],[1,"font-semibold"],[1,"text-sm","mt-1"],[1,"text-emerald-400","hover:text-emerald-600","transition-colors","duration-200",3,"click"],[1,"fa-solid","fa-xmark","text-sm"],[1,"rounded-xl","border","border-rose-200","bg-rose-50","p-4","text-rose-800","animate-fade-in"],[1,"fa-solid","fa-circle-exclamation","text-rose-600","text-lg"],[1,"text-rose-400","hover:text-rose-600","transition-colors","duration-200",3,"click"],[1,"fa-solid","fa-circle-notch","animate-spin"]],template:function(a,n){a&1&&(e(0,"div",0)(1,"header",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),r(6,"i",6),t(),e(7,"div")(8,"nav",7)(9,"a",8),i(10,"Inicio"),t(),r(11,"i",9),e(12,"a",10),i(13,"Matr\xEDculas"),t(),r(14,"i",9),e(15,"span",11),i(16,"Manual \xB7 Matricular"),t()(),e(17,"h1",12),i(18,"Gesti\xF3n de Matr\xEDcula"),t(),e(19,"p",13),i(20,"Registro y administraci\xF3n individual de matr\xEDculas"),t()()(),e(21,"a",14),r(22,"i",15),i(23," Volver a b\xFAsqueda "),t()(),e(24,"div",16)(25,"a",17),r(26,"i",18),i(27," Importaci\xF3n Masiva "),t(),e(28,"a",19),r(29,"i",20),i(30," Buscar Estudiantes "),t(),e(31,"a",21),r(32,"i",22),i(33," Registrar/Editar "),t(),e(34,"a",23),r(35,"i",24),i(36," Gestionar Matr\xEDcula "),t()()()(),e(37,"main",25)(38,"section",26)(39,"div",27)(40,"div",28),r(41,"i",29),t(),e(42,"div")(43,"h2",30),i(44,"Datos de Matr\xEDcula"),t(),e(45,"p",31),i(46,"Completa la informaci\xF3n requerida para el registro"),t()()(),e(47,"div",32)(48,"div",33)(49,"div",34)(50,"label",35),i(51," Per\xEDodo Acad\xE9mico "),e(52,"span",36),i(53,"*"),t()(),e(54,"select",37),c("ngModelChange",function(s){return n.patch({periodo_id:+s})}),e(55,"option",38),i(56,"\u2014 Selecciona un per\xEDodo \u2014"),t(),g(57,W,3,4,"option",39),t(),e(58,"p",40),r(59,"i",41),i(60," Per\xEDodo acad\xE9mico actual activo en el sistema "),t()(),e(61,"div",34)(62,"label",35),i(63," C\xF3digo del Estudiante "),e(64,"span",36),i(65,"*"),t()(),e(66,"div",42)(67,"input",43),c("ngModelChange",function(s){return n.patch({codigo_estudiante:s||null})})("keyup.enter",function(){return n.cargarPorCodigo()})("blur",function(){return n.cargarPorCodigo()}),t(),e(68,"button",44),c("click",function(){return n.cargarPorCodigo()}),r(69,"i",20),t()(),e(70,"p",40),r(71,"i",45),i(72," Escribe el c\xF3digo y presiona "),e(73,"b"),i(74,"Enter"),t(),i(75," o haz clic en la lupa "),t()()(),g(76,X,17,3,"div",46),e(77,"div",33)(78,"div",47)(79,"div",48)(80,"label",35),i(81,"Ciclo"),t(),e(82,"input",49),c("ngModelChange",function(s){return n.patch({ciclo:s||null})}),t()(),e(83,"div",48)(84,"label",35),i(85,"Modalidad de Estudio"),t(),e(86,"select",37),c("ngModelChange",function(s){return n.patch({modalidad_estudio:s||null})}),e(87,"option",50),i(88,"\u2014 Selecciona modalidad \u2014"),t(),e(89,"option"),i(90,"PRESENCIAL"),t(),e(91,"option"),i(92,"SEMIPRESENCIAL"),t(),e(93,"option"),i(94,"VIRTUAL"),t()()(),e(95,"div",48)(96,"label",35),i(97,"Fecha de Matr\xEDcula"),t(),e(98,"input",51),c("ngModelChange",function(s){return n.patch({fecha_matricula:s||null})}),t()()(),e(99,"div",47)(100,"div",48)(101,"label",35),i(102,"Grupo"),t(),e(103,"input",52),c("ngModelChange",function(s){return n.patch({grupo:s||null})}),t()(),e(104,"div",48)(105,"label",35),i(106,"Modo de Contrato"),t(),e(107,"select",37),c("ngModelChange",function(s){return n.patch({modo_contrato:s||null})}),e(108,"option",50),i(109,"\u2014 Selecciona modo \u2014"),t(),e(110,"option"),i(111,"REGULAR"),t(),e(112,"option"),i(113,"CONVENIO"),t(),e(114,"option"),i(115,"BECA"),t(),e(116,"option"),i(117,"OTRO"),t()()()()(),e(118,"div",34),g(119,Y,10,1,"div",53)(120,Z,10,1,"div",54),t(),e(121,"div",55)(122,"button",56),c("click",function(){return n.enviar()}),r(123,"i",57),g(124,ee,1,0,"i",58),i(125),t(),e(126,"button",59),c("click",function(){return n.anular()}),r(127,"i",60),i(128," Anular Matr\xEDcula "),t(),e(129,"button",61),c("click",function(){return n.limpiarFormulario()}),r(130,"i",62),i(131," Limpiar Formulario "),t()()()(),e(132,"section",26)(133,"div",63)(134,"div",64),r(135,"i",65),t(),e(136,"h3",66),i(137,"Informaci\xF3n Importante"),t()(),e(138,"div",67)(139,"div",68),r(140,"i",69),e(141,"div")(142,"div",70),i(143,"Per\xEDodo Acad\xE9mico"),t(),e(144,"div",71),i(145,"Selecciona el per\xEDodo actual activo para la matr\xEDcula"),t()()(),e(146,"div",68),r(147,"i",72),e(148,"div")(149,"div",70),i(150,"C\xF3digo de Estudiante"),t(),e(151,"div",71),i(152,"El c\xF3digo debe corresponder a un estudiante registrado"),t()()(),e(153,"div",68),r(154,"i",73),e(155,"div")(156,"div",70),i(157,"Anulaci\xF3n"),t(),e(158,"div",71),i(159,"La anulaci\xF3n marca la matr\xEDcula como inactiva en el sistema"),t()()(),e(160,"div",68),r(161,"i",74),e(162,"div")(163,"div",70),i(164,"Actualizaci\xF3n"),t(),e(165,"div",71),i(166,"Los cambios se reflejan inmediatamente en el sistema"),t()()()()()()()),a&2&&(o(25),u("routerLinkActiveOptions",F(19,K)),o(29),u("ngModel",n.form().periodo_id||""),o(),u("ngValue",0),o(2),u("ngForOf",n.periodos()),o(10),u("ngModel",n.form().codigo_estudiante||""),o(9),u("ngIf",n.alumnoCard()),o(6),u("ngModel",n.form().ciclo||""),o(4),u("ngModel",n.form().modalidad_estudio||""),o(12),u("ngModel",n.form().fecha_matricula||""),o(5),u("ngModel",n.form().grupo||""),o(4),u("ngModel",n.form().modo_contrato||""),o(12),u("ngIf",n.okMsg()),o(),u("ngIf",n.error()),o(2),u("disabled",n.loading()||!n.form().periodo_id||!n.form().codigo_estudiante),o(),P("hidden",n.loading()),o(),u("ngIf",n.loading()),o(),M(" ",n.loading()?"Procesando...":"Guardar Matr\xEDcula"," "),o(),u("disabled",n.loading()||!n.form().periodo_id||!n.form().codigo_estudiante))},dependencies:[T,A,D,U,q,G,O,B,$,j,V,N,R],encapsulation:2});var J=f;export{J as MManualMatricularPage};
