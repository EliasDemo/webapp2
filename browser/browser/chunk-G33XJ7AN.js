import{a as f}from"./chunk-LWNR2F3M.js";import{B as p,C as E}from"./chunk-FE5WSVYG.js";import{O as h,S as u,o as l}from"./chunk-63T4HJ2B.js";import{a as b,c as g}from"./chunk-IMPBB4AK.js";var d=class d{constructor(e,t){this.http=e;let i=t??"/api";this.baseUrl=i.endsWith("/")?i.slice(0,-1):i}eventosUrl(){return`${this.baseUrl}/vm/eventos`}eventoCategoriasUrl(){return`${this.baseUrl}/vm/eventos/categorias`}lookupsUrl(){return`${this.baseUrl}/lookups`}listarEventos(e){let t=new p;return e&&Object.entries(e).forEach(([i,o])=>{o!=null&&o!==""&&(t=t.set(i,String(o)))}),this.http.get(this.eventosUrl(),{params:t}).pipe(l(i=>{let o=v(i),m=i?.meta??i?.data?.meta??void 0,r=m?.total??i?.total??i?.data?.total??o.length;return{ok:i?.ok??!0,data:{items:o,total:r},meta:m}}))}obtenerEvento(e){return this.http.get(`${this.eventosUrl()}/${e}`)}crearEvento(e){let c=e,{target_type:t,target_id:i,targetable_type:o,targetable_id:m,ep_sede_id:r}=c,a=g(c,["target_type","target_id","targetable_type","targetable_id","ep_sede_id"]),n=b({},a);return n.periodo_id!==void 0&&(n.periodo_id=Number(n.periodo_id)),n.cupo_maximo!==void 0&&n.cupo_maximo!==null&&(n.cupo_maximo=Number(n.cupo_maximo)),n.categoria_evento_id!==void 0&&n.categoria_evento_id!==null&&(n.categoria_evento_id=Number(n.categoria_evento_id)),this.http.post(this.eventosUrl(),n)}actualizarEvento(e,t){return this.http.put(`${this.eventosUrl()}/${e}`,t)}eliminarEvento(e){return this.http.delete(`${this.eventosUrl()}/${e}`)}listarCategoriasEvento(){return this.http.get(this.eventoCategoriasUrl()).pipe(l(e=>Array.isArray(e)?e:Array.isArray(e?.data)?e.data:Array.isArray(e?.items)?e.items:Array.isArray(e?.data?.items)?e.data.items:Array.isArray(e?.data?.data)?e.data.data:Array.isArray(e?.categorias)?e.categorias:[]))}listarImagenesEvento(e){return this.http.get(`${this.eventosUrl()}/${e}/imagenes`).pipe(l(t=>({ok:t?.ok??!0,data:v(t),meta:t?.meta})))}subirImagenEvento(e,t){let i=new FormData;return i.append("file",t),this.http.post(`${this.eventosUrl()}/${e}/imagenes`,i)}eliminarImagenEvento(e,t){return this.http.delete(`${this.eventosUrl()}/${e}/imagenes/${t}`)}actualizarImagenEvento(e,t,i){return this.http.patch(`${this.eventosUrl()}/${e}/imagenes/${t}`,i)}fetchPeriodos(e="",t=!1,i=50){let o=new p().set("limit",String(i)).set("solo_activos",t?"1":"0");return e&&(o=o.set("q",e)),this.http.get(`${this.lookupsUrl()}/periodos`,{params:o}).pipe(l(m=>v(m).map(r=>({id:r.id,anio:r.anio,ciclo:String(r.ciclo),estado:r.estado,fecha_inicio:r.fecha_inicio,fecha_fin:r.fecha_fin}))))}listarInscritosEvento(e,t){let i=new p;return t?.estado&&t.estado!=="TODOS"&&(i=i.set("estado",t.estado)),t?.roles&&t.roles.length>0&&t.roles.forEach(o=>{i=i.append("roles[]",o)}),this.http.get(`${this.eventosUrl()}/${e}/inscritos`,{params:i})}listarCandidatosEvento(e,t){let i=new p;return t?.q&&(i=i.set("q",t.q)),typeof t?.solo_elegibles=="boolean"&&(i=i.set("solo_elegibles",t.solo_elegibles?"1":"0")),typeof t?.limit=="number"&&t.limit>0&&(i=i.set("limit",String(t.limit))),this.http.get(`${this.eventosUrl()}/${e}/candidatos`,{params:i})}listarMisEventos(e){let t=new p;return e?.periodo_id!==void 0&&e.periodo_id!==null&&(t=t.set("periodo_id",String(e.periodo_id))),e?.estado_participacion&&(t=t.set("estado_participacion",e.estado_participacion)),this.http.get(`${this.baseUrl}/vm/mis-eventos`,{params:t}).pipe(l(i=>{let o=i?.data??i??{},m=(o.periodos??[]).map(a=>({id:Number(a.id),anio:Number(a.anio),ciclo:String(a.ciclo),estado:a.estado,fecha_inicio:a.fecha_inicio??void 0,fecha_fin:a.fecha_fin??void 0,total_eventos:Number(a.total_eventos??0)})),r=(o.eventos??[]).map(a=>({id:Number(a.id),codigo:a.codigo,titulo:a.titulo,subtitulo:a.subtitulo??null,modalidad:a.modalidad,estado:a.estado,periodo_id:Number(a.periodo_id),requiere_inscripcion:!!a.requiere_inscripcion,cupo_maximo:a.cupo_maximo!==null&&a.cupo_maximo!==void 0?Number(a.cupo_maximo):null,periodo:{id:Number(a.periodo?.id??a.periodo_id),anio:Number(a.periodo?.anio),ciclo:String(a.periodo?.ciclo),estado:a.periodo?.estado},participacion:{id:Number(a.participacion?.id),estado:a.participacion?.estado}}));return{ok:i?.ok??!0,data:{periodos:m,eventos:r},meta:i?.meta}}))}};d.\u0275fac=function(t){return new(t||d)(u(E),u(f,8))},d.\u0275prov=h({token:d,factory:d.\u0275fac,providedIn:"root"});var V=d;function v(s){return Array.isArray(s)?s:Array.isArray(s?.items)?s.items:Array.isArray(s?.data)?s.data:Array.isArray(s?.data?.items)?s.data.items:Array.isArray(s?.data?.data)?s.data.data:[]}export{V as a};
