import{a as me}from"./chunk-IZ77CWTJ.js";import{a as pe}from"./chunk-VU2HTVBD.js";import{A as de,b as ie,d as oe,i as re,r as ae,s as le,t as se}from"./chunk-J2XPQYKK.js";import{a as ce}from"./chunk-QG2H74YZ.js";import"./chunk-LWNR2F3M.js";import{g as A}from"./chunk-5VQTM22E.js";import{i as te,j as M,k as T,q as ne,u as N}from"./chunk-FE5WSVYG.js";import{$ as y,$a as i,Ea as q,Gb as X,Ka as V,Kb as Z,Mb as J,Ob as B,Pa as m,Ra as $,T as D,Tb as E,Xb as ee,Y as g,Z as f,Za as Q,_,_a as c,ab as r,bb as h,eb as I,fa as C,fb as P,gb as b,ia as U,kb as u,mb as p,n as L,ob as K,pb as W,qb as Y,rb as R,tb as F,ua as z,vb as s,wa as G,wb as v,xb as w,ya as l,yb as H}from"./chunk-63T4HJ2B.js";import"./chunk-IMPBB4AK.js";var xe=["descRef"],_e=a=>["/vm/proyectos",a];function ye(a,e){if(a&1&&(i(0,"span",34),s(1),r()),a&2){let t=p().ngIf;l(),w(" ",t.modalidad," ")}}function be(a,e){if(a&1&&(i(0,"span",35),s(1),r()),a&2){let t=p().ngIf;l(),w(" ",t.tipo," ")}}function ve(a,e){if(a&1&&h(0,"span",44),a&2){let t=e.index,n=p(3);F("bg-white",t===n.currentImgIndex)("bg-white/50",t!==n.currentImgIndex)}}function we(a,e){if(a&1){let t=b();i(0,"div",36)(1,"button",37),u("click",function(o){g(t);let d=p(2);return f(d.prevImg(o))}),_(),i(2,"svg",38),h(3,"path",39),r()(),y(),i(4,"div",40),m(5,ve,1,4,"span",41),r(),i(6,"button",42),u("click",function(o){g(t);let d=p(2);return f(d.nextImg(o))}),_(),i(7,"svg",38),h(8,"path",43),r()()()}if(a&2){let t=p(2);l(5),c("ngForOf",t.images)("ngForTrackBy",t.trackByIndex)}}function Ce(a,e){if(a&1&&(i(0,"span",45),_(),i(1,"svg",17),h(2,"path",46),r(),s(3," Ciclos: "),y(),i(4,"b",47),s(5),r()()),a&2){let t=e.ngIf;l(5),v(t)}}function Ie(a,e){if(a&1&&(i(0,"span",45),_(),i(1,"svg",17),h(2,"path",48),r(),s(3," Creado: "),y(),i(4,"b",47),s(5),Z(6,"date"),r()()),a&2){let t=p().ngIf;l(5),v(J(6,1,t.created_at,"mediumDate"))}}function Pe(a,e){if(a&1&&(i(0,"p",49,0),s(2),r()),a&2){let t=p().ngIf,n=p();F("line-clamp-none",n.expanded),l(2),w(" ",t.descripcion," ")}}function Ee(a,e){if(a&1&&(i(0,"div",25),_(),i(1,"svg",17),h(2,"path",50),r(),y(),i(3,"dt",27),s(4,"Im\xE1genes"),r(),i(5,"dd"),s(6,"Im\xE1genes: "),i(7,"b",28),s(8),r()()()),a&2){let t=p().ngIf;l(8),v(t.imagenes_total)}}function Se(a,e){if(a&1){let t=b();i(0,"button",51),u("click",function(o){g(t);let d=p(2);return f(d.toggleExpand(o))}),s(1),r()}if(a&2){let t=p(2);l(),w(" ",t.expanded?"Ver menos":"Ver m\xE1s"," ")}}function ke(a,e){if(a&1){let t=b();i(0,"button",52),u("click",function(){g(t);let o=p().ngIf,d=p();return f(d.delete.emit(o.id))}),_(),i(1,"svg",53),h(2,"path",54),r(),s(3," Eliminar "),r()}}function Le(a,e){if(a&1){let t=b();I(0),i(1,"article",2),u("keydown",function(o){g(t);let d=p();return f(d.onKeydown(o))}),i(2,"div",3)(3,"img",4),u("error",function(o){g(t);let d=p();return f(d.onImgError(o))}),r(),h(4,"div",5),i(5,"div",6),m(6,ye,2,1,"span",7)(7,be,2,1,"span",8),r(),i(8,"div",9)(9,"span",10),s(10),r()(),m(11,we,9,2,"div",11),r(),i(12,"div",12)(13,"header",13)(14,"h3",14),s(15),r(),i(16,"div",15)(17,"span",16),_(),i(18,"svg",17),h(19,"path",18),r(),s(20," C\xF3digo: "),y(),i(21,"span",19),s(22),r()(),m(23,Ce,6,1,"span",20)(24,Ie,7,4,"span",20),r()(),m(25,Pe,3,3,"p",21),h(26,"div",22),i(27,"div",23)(28,"dl",24)(29,"div",25),_(),i(30,"svg",17),h(31,"path",26),r(),y(),i(32,"dt",27),s(33,"Horas planificadas"),r(),i(34,"dd"),s(35,"Horas: "),i(36,"b",28),s(37),r()()(),m(38,Ee,9,1,"div",29),r(),i(39,"div",30),m(40,Se,2,1,"button",31),i(41,"a",32),s(42," Ver detalles "),r(),m(43,ke,4,0,"button",33),r()()()(),P()}if(a&2){let t=e.ngIf,n=p();l(),Q("aria-label",t.titulo||"Proyecto"),l(2),c("src",n.currentImgSrc,z)("alt",t.titulo||"Proyecto"),l(3),c("ngIf",t.modalidad),l(),c("ngIf",t.tipo),l(2),c("ngClass",n.estadoClass),l(),w(" ",n.estadoLabel," "),l(),c("ngIf",n.images.length>1),l(4),w(" ",t.titulo," "),l(7),v(t.codigo||"\u2014"),l(),c("ngIf",n.nivelesLabel),l(),c("ngIf",t.created_at),l(),c("ngIf",t.descripcion),l(12),v(t.horas_planificadas),l(),c("ngIf",t.imagenes_total!=null),l(2),c("ngIf",n.showSeeMore||n.expanded),l(),c("routerLink",X(18,_e,t.id)),l(2),c("ngIf",n.isEliminable)}}var S=class S{constructor(e){this.cdr=e;this.delete=new $;this.expanded=!1;this.showSeeMore=!1;this.images=[];this.currentImgIndex=0;this.placeholder="data:image/svg+xml;utf8,"+encodeURIComponent(`
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 225">
      <rect width="400" height="225" fill="#e8ecff"/>
      <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"
            font-family="system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, sans-serif"
            font-size="18" fill="#64748b">Sin imagen</text>
    </svg>
  `)}ngOnChanges(e){e.proyecto&&(this.images=this.buildImages(this.proyecto),this.currentImgIndex=0,this.expanded=!1,queueMicrotask(()=>this.checkOverflow()))}ngAfterViewInit(){this.resizeObs=new ResizeObserver(()=>this.checkOverflow()),this.descRef?.nativeElement&&this.resizeObs.observe(this.descRef.nativeElement),this.checkOverflow()}ngOnDestroy(){this.resizeObs?.disconnect()}get currentImgSrc(){if(!this.images.length)return this.placeholder;let e=Math.min(Math.max(this.currentImgIndex,0),this.images.length-1);return this.images[e]||this.placeholder}get estadoClass(){let e=(this.proyecto.estado||"").toUpperCase();return e==="PLANIFICADO"?"bg-blue-50 text-blue-700 border-blue-200":e==="EN_CURSO"?"bg-green-50 text-green-700 border-green-200":e==="CERRADO"?"bg-red-50 text-red-700 border-red-200":e==="FINALIZADO"?"bg-emerald-50 text-emerald-700 border-emerald-200":e==="CANCELADO"?"bg-gray-100 text-gray-700 border-gray-200":"bg-gray-50 text-gray-700 border-gray-200"}get estadoLabel(){return(this.proyecto.estado||"").toUpperCase()||"\u2014"}get isEliminable(){return(this.proyecto.estado||"").toUpperCase()==="PLANIFICADO"}get nivelesLabel(){let e=Array.isArray(this.proyecto.niveles)&&this.proyecto.niveles.length?[...this.proyecto.niveles]:this.proyecto.nivel!=null?[this.proyecto.nivel]:[];return e.length?this.compactRanges(e.sort((t,n)=>t-n)):null}toggleExpand(e){e?.stopPropagation(),this.expanded=!this.expanded,this.cdr.markForCheck(),queueMicrotask(()=>this.checkOverflow())}prevImg(e){e?.stopPropagation(),this.images.length&&(this.currentImgIndex=(this.currentImgIndex-1+this.images.length)%this.images.length,this.cdr.markForCheck())}nextImg(e){e?.stopPropagation(),this.images.length&&(this.currentImgIndex=(this.currentImgIndex+1)%this.images.length,this.cdr.markForCheck())}onImgError(e){let t=e.target;t&&(t.src=this.placeholder)}onWindowResize(){this.checkOverflow()}onKeydown(e){this.images.length>1&&(e.key==="ArrowLeft"?(this.prevImg(),e.preventDefault()):e.key==="ArrowRight"&&(this.nextImg(),e.preventDefault()))}trackByIndex(e){return e}checkOverflow(){let e=this.descRef?.nativeElement;if(!e){this.showSeeMore=!1;return}let t=e.scrollHeight-e.clientHeight>2,n=!this.expanded&&t;this.showSeeMore!==n&&(this.showSeeMore=n,this.cdr.markForCheck())}buildImages(e){let t=e.cover_url?[e.cover_url]:[],n=(e.imagenes??[]).map(d=>d?.url||"").filter(Boolean),o=[...t,...n];return o.length===0?[this.defaultByModalidad(e.modalidad)]:Array.from(new Set(o))}defaultByModalidad(e){let t=(e||"").toUpperCase();return t==="PRESENCIAL"?"/assets/proyectos/presencial.svg":t==="VIRTUAL"?"/assets/proyectos/virtual.svg":t==="MIXTA"?"/assets/proyectos/mixta.svg":"/assets/proyectos/default.svg"}compactRanges(e){if(!e.length)return"";let t=[],n=e[0],o=e[0];for(let d=1;d<e.length;d++){let x=e[d];if(x===o+1){o=x;continue}t.push(n===o?`${n}`:`${n}\u2013${o}`),n=o=x}return t.push(n===o?`${n}`:`${n}\u2013${o}`),t.join(", ")}};S.\u0275fac=function(t){return new(t||S)(q(ee))},S.\u0275cmp=V({type:S,selectors:[["app-proyecto-card"]],viewQuery:function(t,n){if(t&1&&K(xe,5),t&2){let o;W(o=Y())&&(n.descRef=o.first)}},hostBindings:function(t,n){t&1&&u("resize",function(){return n.onWindowResize()},G)},inputs:{proyecto:"proyecto"},outputs:{delete:"delete"},features:[U],decls:1,vars:1,consts:[["descRef",""],[4,"ngIf"],["tabindex","0","role","region","aria-roledescription","tarjeta de proyecto",1,"proy-card","group","relative","rounded-xl","border","border-gray-200","bg-white","shadow-sm","hover:shadow-lg","focus-within:shadow-lg","transition-all","duration-300","overflow-hidden","flex","flex-col","h-full",3,"keydown"],[1,"relative","aspect-[16/9]","bg-gray-100","shrink-0","overflow-hidden"],["width","720","height","405","loading","lazy","decoding","async",1,"w-full","h-full","object-cover","transition-transform","duration-500","group-hover:scale-[1.03]",3,"error","src","alt"],[1,"pointer-events-none","absolute","inset-0","bg-gradient-to-t","from-black/30","via-transparent","to-transparent"],[1,"absolute","top-3","left-3","flex","items-center","gap-2"],["class","text-xs bg-indigo-600 text-white px-3 py-1 rounded-full shadow-md font-medium",4,"ngIf"],["class","text-xs bg-black/60 text-white px-3 py-1 rounded-full shadow font-medium backdrop-blur",4,"ngIf"],[1,"absolute","top-3","right-3"],[1,"ml-3","px-2.5","py-1","rounded-full","text-xs","font-semibold","border","whitespace-nowrap",3,"ngClass"],["class","absolute inset-x-0 bottom-0 p-3 flex items-center justify-between",4,"ngIf"],[1,"p-5","flex","flex-col","gap-3","grow"],[1,"min-w-0"],[1,"font-bold","text-lg","text-gray-900","leading-tight","line-clamp-2"],[1,"mt-2","flex","flex-wrap","items-center","gap-x-4","gap-y-2","text-sm","text-gray-600"],[1,"inline-flex","items-center","min-w-0"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","mr-1","text-gray-500"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"],[1,"font-mono","ml-1","truncate","max-w-[140px]"],["class","inline-flex items-center",4,"ngIf"],["class","text-sm text-gray-700 transition-all duration-300 line-clamp-3",3,"line-clamp-none",4,"ngIf"],[1,"mt-1","grow"],[1,"pt-4","flex","items-center","justify-between","border-t","border-gray-100"],[1,"text-sm","text-gray-700","flex","items-center","gap-4"],[1,"flex","items-center"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"],[1,"sr-only"],[1,"text-gray-900"],["class","flex items-center",4,"ngIf"],[1,"flex","items-center","gap-2"],["type","button","class","px-3 py-1.5 rounded-lg bg-gray-100 hover:bg-gray-200 text-gray-700 text-sm font-medium transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-gray-300",3,"click",4,"ngIf"],[1,"px-3","py-1.5","rounded-lg","text-white","bg-blue-600","hover:bg-blue-700","text-sm","font-medium","transition-colors","duration-200","focus:outline-none","focus:ring-2","focus:ring-blue-500","focus:ring-offset-2",3,"routerLink"],["class","px-3 py-1.5 rounded-lg text-red-700 bg-red-50 border border-red-200 text-sm font-medium hover:bg-red-100 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-red-500",3,"click",4,"ngIf"],[1,"text-xs","bg-indigo-600","text-white","px-3","py-1","rounded-full","shadow-md","font-medium"],[1,"text-xs","bg-black/60","text-white","px-3","py-1","rounded-full","shadow","font-medium","backdrop-blur"],[1,"absolute","inset-x-0","bottom-0","p-3","flex","items-center","justify-between"],["aria-label","Imagen anterior",1,"bg-white/90","hover:bg-white","rounded-full","p-2","shadow-lg","transition-all","duration-200","hover:scale-110","focus:outline-none","focus:ring-2","focus:ring-indigo-500",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","text-gray-700"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M15 19l-7-7 7-7"],[1,"flex","space-x-1"],["class","w-2 h-2 rounded-full transition-all duration-300",3,"bg-white","bg-white/50",4,"ngFor","ngForOf","ngForTrackBy"],["aria-label","Imagen siguiente",1,"bg-white/90","hover:bg-white","rounded-full","p-2","shadow-lg","transition-all","duration-200","hover:scale-110","focus:outline-none","focus:ring-2","focus:ring-indigo-500",3,"click"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M9 5l7 7-7 7"],[1,"w-2","h-2","rounded-full","transition-all","duration-300"],[1,"inline-flex","items-center"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"],[1,"text-gray-900","ml-1"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M8 7V3m8 4V3M3 11h18M5 19h14a2 2 0 002-2v-6H3v6a2 2 0 002 2z"],[1,"text-sm","text-gray-700","transition-all","duration-300","line-clamp-3"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2z"],["type","button",1,"px-3","py-1.5","rounded-lg","bg-gray-100","hover:bg-gray-200","text-gray-700","text-sm","font-medium","transition-colors","duration-200","focus:outline-none","focus:ring-2","focus:ring-gray-300",3,"click"],[1,"px-3","py-1.5","rounded-lg","text-red-700","bg-red-50","border","border-red-200","text-sm","font-medium","hover:bg-red-100","transition-colors","duration-200","focus:outline-none","focus:ring-2","focus:ring-red-500",3,"click"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-4","h-4","inline","mr-1","-mt-0.5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1 1v3M4 7h16"]],template:function(t,n){t&1&&m(0,Le,44,20,"ng-container",1),t&2&&c("ngIf",n.proyecto)},dependencies:[N,te,M,T,A,ne],styles:[".line-clamp-2[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}[_nghost-%COMP%]     .proy-card a:focus-visible, [_nghost-%COMP%]     .proy-card button:focus-visible{outline:2px solid #6366f1;outline-offset:2px}.proy-card[_ngcontent-%COMP%]{will-change:transform,box-shadow;backface-visibility:hidden}"],changeDetection:0});var O=S;function Ve(a,e){if(a&1&&(i(0,"option",21),s(1),r()),a&2){let t,n=p();c("ngValue","CURRENT"),l(),H(" Periodo actual (",(t=n.defaultPeriodo())==null?null:t.anio,"-",(t=n.defaultPeriodo())==null?null:t.ciclo,") ")}}function Me(a,e){if(a&1&&(i(0,"span"),s(1),r()),a&2){let t=p().$implicit;l(),w("(",t.estado,")")}}function Te(a,e){if(a&1&&(i(0,"option",21),s(1),m(2,Me,2,1,"span",32),r()),a&2){let t=e.$implicit;c("ngValue",t.id),l(),H(" ",t.anio,"-",t.ciclo," "),l(),c("ngIf",t.estado)}}function Ne(a,e){if(a&1&&(I(0),i(1,"optgroup",30),m(2,Te,3,4,"option",31),r(),P()),a&2){let t=e.$implicit;l(),c("label","A\xF1o "+t.anio),l(),c("ngForOf",t.items)}}function Ae(a,e){if(a&1){let t=b();i(0,"button",40),u("click",function(){g(t);let o=p(3);return f(o.handleClear())}),s(1," Limpiar filtros "),r()}}function Oe(a,e){if(a&1){let t=b();i(0,"app-proyecto-card",41),u("delete",function(o){g(t);let d=p(3);return f(d.onDelete(o))}),r()}if(a&2){let t=e.$implicit;c("proyecto",t)}}function De(a,e){if(a&1&&(I(0),i(1,"div",33)(2,"p",34),s(3," Mostrando "),i(4,"span",35),s(5),r(),s(6," de "),i(7,"span",36),s(8),r(),s(9," proyectos "),r(),m(10,Ae,2,0,"button",37),r(),i(11,"div",38),m(12,Oe,1,1,"app-proyecto-card",39),r(),P()),a&2){let t=p(2);l(5),v(t.filtered().length),l(3),v(t.items().length),l(2),c("ngIf",t.hasActiveFilters()),l(2),c("ngForOf",t.filtered())}}function Re(a,e){if(a&1&&(I(0),m(1,De,13,4,"ng-container",29),P()),a&2){let t=p(),n=R(46);l(),c("ngIf",t.filtered().length)("ngIfElse",n)}}function Fe(a,e){a&1&&(i(0,"div",42),h(1,"div",43),r())}function He(a,e){a&1&&(i(0,"div",44)(1,"h3",45),s(2,"No se encontraron proyectos"),r(),i(3,"p",46),s(4,"Usa otros filtros o crea uno nuevo."),r(),i(5,"a",47),s(6,"Crear proyecto"),r()())}var k=class k{constructor(){this.api=D(ce);this.lookups=D(me);this.loading=C(!0);this.items=C([]);this.q=C("");this.periodos=C([]);this.defaultPeriodoId=C(null);this.selectedPeriodoId=C(null);this.tipo=C("ALL");this.findPeriodoById=e=>e?this.periodos().find(t=>t.id===e)??null:null;this.defaultPeriodo=E(()=>this.findPeriodoById(this.defaultPeriodoId()));this.orderedPeriodos=E(()=>[...this.periodos()].sort((e,t)=>{if(e.anio!==t.anio)return t.anio-e.anio;let n=Number(e.ciclo);return Number(t.ciclo)-n}));this.periodoGroups=E(()=>{let e=[],t=new Map;for(let n of this.orderedPeriodos()){let o=t.get(n.anio)??[];o.push(n),t.set(n.anio,o)}for(let[n,o]of t.entries())e.push({anio:n,items:o});return e.sort((n,o)=>o.anio-n.anio),e});this.filtered=E(()=>{let e=this.items(),t=this.normalizedPeriodoId();typeof t=="number"&&(e=e.filter(d=>d.periodo_id===t));let n=this.tipo();n!=="ALL"&&(e=e.filter(d=>d.tipo===n));let o=this.q().toLowerCase();return o&&(e=e.filter(d=>(d.titulo?.toLowerCase()??"").includes(o)||(d.codigo??"").toLowerCase().includes(o))),e});this.hasActiveFilters=E(()=>{let e=this.normalizedPeriodoId(),t=this.defaultPeriodoId()??void 0,n=e!==void 0&&e!==t||e===void 0&&t!==void 0&&this.selectedPeriodoId()!=="CURRENT";return!!this.q()||this.tipo()!=="ALL"||n});this.loadPeriodosYPrimeraCarga()}normalizedPeriodoId(){let e=this.selectedPeriodoId();if(!(e==="ALL"||e===null))return e==="CURRENT"?this.defaultPeriodoId()??void 0:Number(e)||void 0}isAllSelected(){return this.selectedPeriodoId()==="ALL"}async handleSearch(){let e=this.normalizedPeriodoId();await this.fetchData(this.q(),e,this.tipo())}async handleClear(){this.q.set(""),this.tipo.set("ALL"),this.selectedPeriodoId.set("CURRENT"),await this.fetchData(void 0,this.defaultPeriodoId()??void 0,void 0)}onPeriodoChange(e){e==="ALL"?this.selectedPeriodoId.set("ALL"):e==="CURRENT"?this.selectedPeriodoId.set("CURRENT"):this.selectedPeriodoId.set(Number(e)||null)}onTipoChange(e){this.tipo.set(e??"ALL")}async onDelete(e){let t=this.items().find(n=>n.id===e);!t||t.estado!=="PLANIFICADO"||confirm(`\xBFEliminar el proyecto "${t.titulo}"?`)&&(await L(this.api.eliminarProyecto(e)),this.items.set(this.items().filter(n=>n.id!==e)))}async stepPeriodo(e){let t=this.orderedPeriodos(),n=this.normalizedPeriodoId()??this.defaultPeriodoId()??null;if(!n)return;let o=t.findIndex(x=>x.id===n);if(o<0)return;let d=t[o+e];d&&(this.selectedPeriodoId.set(d.id),await this.fetchData(this.q(),d.id,this.tipo()))}async loadPeriodosYPrimeraCarga(){try{let e=await L(this.lookups.fetchPeriodos("",!1,500));e.sort((o,d)=>d.anio-o.anio||Number(d.ciclo)-Number(o.ciclo)),this.periodos.set(e);let n=(e.find(o=>o.estado==="EN_CURSO")??e.find(o=>o.estado==="PLANIFICADO")??e[0])?.id??null;this.defaultPeriodoId.set(n),this.selectedPeriodoId.set("CURRENT"),await this.fetchData(void 0,n??void 0,void 0)}finally{this.loading.set(!1)}}async fetchData(e,t,n){this.loading.set(!0);try{let o={};e&&(o.q=e),typeof t=="number"&&(o.periodo_id=t),n&&(j=>j==="LIBRE"||j==="VINCULADO")(n)&&(o.tipo=n);let x=await L(this.api.listarProyectos(Object.keys(o).length?o:void 0));pe(x)&&this.items.set(x.data.data)}finally{this.loading.set(!1)}}};k.\u0275fac=function(t){return new(t||k)},k.\u0275cmp=V({type:k,selectors:[["app-proyecto-list-page"]],decls:47,vars:13,consts:[["loadingTpl",""],["emptyTpl",""],[1,"min-h-screen","bg-slate-50","py-8"],[1,"mx-auto","max-w-7xl","px-4"],[1,"mb-12","flex","flex-col","sm:flex-row","sm:items-center","sm:justify-between","gap-6"],[1,"space-y-3"],[1,"flex","items-center","gap-3"],[1,"p-2","bg-white","rounded-xl","shadow-sm","border","border-gray-100"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-6","h-6","text-blue-600"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"],[1,"text-4xl","font-bold","bg-gradient-to-r","from-gray-900","to-blue-700","bg-clip-text","text-transparent"],[1,"text-gray-600","text-base","font-medium","flex","items-center","gap-2"],[1,"w-2","h-2","bg-blue-500","rounded-full"],["routerLink","/vm/proyectos/nuevo",1,"whitespace-nowrap","bg-gradient-to-r","from-blue-600","to-indigo-600","hover:from-blue-700","hover:to-indigo-700","text-white","shadow-lg","hover:shadow-xl","transform","hover:scale-105","active:scale-95","transition-all","duration-300","font-semibold","border-0","px-6","py-3.5","rounded-xl"],[1,"flex","items-center","gap-2"],["fill","none","stroke","currentColor","viewBox","0 0 24 24",1,"w-5","h-5"],["stroke-linecap","round","stroke-linejoin","round","stroke-width","2","d","M12 4v16m8-8H4"],[1,"bg-white","rounded-xl","border","p-4","mb-6","flex","flex-col","xl:flex-row","gap-3"],["title","Periodo anterior",1,"px-3","py-2","rounded-lg","border","hover:bg-gray-50",3,"click","disabled"],[1,"border","rounded-lg","px-3","py-2","min-w-[260px]",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngIf"],[3,"ngValue"],[4,"ngFor","ngForOf"],["title","Periodo siguiente",1,"px-3","py-2","rounded-lg","border","hover:bg-gray-50",3,"click","disabled"],[1,"border","rounded-lg","px-3","py-2",3,"ngModelChange","ngModel"],["placeholder","Buscar por t\xEDtulo o c\xF3digo\u2026",1,"border","rounded-lg","px-3","py-2","flex-1",3,"ngModelChange","ngModel"],[1,"flex","gap-2"],[1,"px-4","py-2","rounded-lg","bg-blue-600","text-white",3,"click"],[1,"px-4","py-2","rounded-lg","border",3,"click"],[4,"ngIf","ngIfElse"],[3,"label"],[3,"ngValue",4,"ngFor","ngForOf"],[4,"ngIf"],[1,"mb-6","flex","items-center","justify-between"],[1,"text-gray-600","font-medium"],[1,"text-blue-600","font-semibold"],[1,"text-gray-800","font-semibold"],["class","text-sm text-blue-600",3,"click",4,"ngIf"],[1,"grid","grid-cols-1","md:grid-cols-2","xl:grid-cols-3","gap-6"],[3,"proyecto","delete",4,"ngFor","ngForOf"],[1,"text-sm","text-blue-600",3,"click"],[3,"delete","proyecto"],[1,"flex","justify-center","items-center","py-20"],[1,"animate-spin","rounded-full","h-14","w-14","border-b-2","border-blue-600"],[1,"text-center","py-20","bg-white","rounded-2xl","shadow-sm","border"],[1,"text-lg","font-semibold","mb-2"],[1,"text-gray-600","mb-6"],["routerLink","/vm/proyectos/nuevo",1,"px-4","py-2","rounded-lg","bg-blue-600","text-white"]],template:function(t,n){if(t&1){let o=b();i(0,"div",2)(1,"div",3)(2,"div",4)(3,"div",5)(4,"div",6)(5,"div",7),_(),i(6,"svg",8),h(7,"path",9),r()(),y(),i(8,"h1",10),s(9," Proyectos "),r()(),i(10,"p",11),h(11,"span",12),s(12," Gesti\xF3n de proyectos de tu EP_SEDE "),r()(),i(13,"a",13)(14,"span",14),_(),i(15,"svg",15),h(16,"path",16),r(),s(17," Nuevo Proyecto "),r()()(),y(),i(18,"div",17)(19,"div",14)(20,"button",18),u("click",function(){return g(o),f(n.stepPeriodo(-1))}),s(21," \u2190 "),r(),i(22,"select",19),u("ngModelChange",function(x){return g(o),f(n.onPeriodoChange(x))}),m(23,Ve,2,3,"option",20),i(24,"option",21),s(25,"Todos los periodos"),r(),m(26,Ne,3,2,"ng-container",22),r(),i(27,"button",23),u("click",function(){return g(o),f(n.stepPeriodo(1))}),s(28," \u2192 "),r()(),i(29,"select",24),u("ngModelChange",function(x){return g(o),f(n.onTipoChange(x))}),i(30,"option",21),s(31,"Todos los tipos"),r(),i(32,"option",21),s(33,"Vinculado"),r(),i(34,"option",21),s(35,"Libre"),r()(),i(36,"input",25),u("ngModelChange",function(x){return g(o),f(n.q.set(x))}),r(),i(37,"div",26)(38,"button",27),u("click",function(){return g(o),f(n.handleSearch())}),s(39,"Buscar"),r(),i(40,"button",28),u("click",function(){return g(o),f(n.handleClear())}),s(41,"Limpiar"),r()()(),m(42,Re,2,2,"ng-container",29)(43,Fe,2,0,"ng-template",null,0,B)(45,He,7,0,"ng-template",null,1,B),r()()}if(t&2){let o=R(44);l(20),c("disabled",n.isAllSelected()),l(2),c("ngModel",n.selectedPeriodoId()),l(),c("ngIf",n.defaultPeriodo()),l(),c("ngValue","ALL"),l(2),c("ngForOf",n.periodoGroups()),l(),c("disabled",n.isAllSelected()),l(2),c("ngModel",n.tipo()),l(),c("ngValue","ALL"),l(2),c("ngValue","VINCULADO"),l(2),c("ngValue","LIBRE"),l(2),c("ngModel",n.q()),l(6),c("ngIf",!n.loading())("ngIfElse",o)}},dependencies:[N,M,T,A,de,le,se,ie,ae,oe,re,O],encapsulation:2});var ue=k;export{ue as ProyectoListPage};
